\doxysection{BDCSVD.\+h}
\hypertarget{_b_d_c_s_v_d_8h_source}{}\label{_b_d_c_s_v_d_8h_source}\index{packages/Eigen.3.3.3/build/native/include/Eigen/src/SVD/BDCSVD.h@{packages/Eigen.3.3.3/build/native/include/Eigen/src/SVD/BDCSVD.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ This\ file\ is\ part\ of\ Eigen,\ a\ lightweight\ C++\ template\ library}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ for\ linear\ algebra.}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ }}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ We\ used\ the\ "{}A\ Divide-\/And-\/Conquer\ Algorithm\ for\ the\ Bidiagonal\ SVD"{}}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ research\ report\ written\ by\ Ming\ Gu\ and\ Stanley\ C.Eisenstat}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ The\ code\ variable\ names\ correspond\ to\ the\ names\ they\ used\ in\ their\ }}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ report}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ Copyright\ (C)\ 2013\ Gauthier\ Brun\ <brun.gauthier@gmail.com>}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ Copyright\ (C)\ 2013\ Nicolas\ Carre\ <nicolas.carre@ensimag.fr>}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Copyright\ (C)\ 2013\ Jean\ Ceccato\ <jean.ceccato@ensimag.fr>}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ Copyright\ (C)\ 2013\ Pierre\ Zoppitelli\ <pierre.zoppitelli@ensimag.fr>}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ Copyright\ (C)\ 2013\ Jitse\ Niesen\ <jitse@maths.leeds.ac.uk>}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ Copyright\ (C)\ 2014-\/2016\ Gael\ Guennebaud\ <gael.guennebaud@inria.fr>}}
\DoxyCodeLine{00015\ \textcolor{comment}{//}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ Source\ Code\ Form\ is\ subject\ to\ the\ terms\ of\ the\ Mozilla}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ Public\ License\ v.\ 2.0.\ If\ a\ copy\ of\ the\ MPL\ was\ not\ distributed}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ with\ this\ file,\ You\ can\ obtain\ one\ at\ http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#ifndef\ EIGEN\_BDCSVD\_H}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#define\ EIGEN\_BDCSVD\_H}}
\DoxyCodeLine{00022\ \textcolor{comment}{//\ \#define\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00023\ \textcolor{comment}{//\ \#define\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{namespace\ }Eigen\ \{}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00028\ IOFormat\ bdcsvdfmt(8,\ 0,\ \textcolor{stringliteral}{"{},\ "{}},\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \textcolor{stringliteral}{"{}\ \ ["{}},\ \textcolor{stringliteral}{"{}]"{}});}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00030\ \ \ }
\DoxyCodeLine{00031\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ \_MatrixType>\ \textcolor{keyword}{class\ }BDCSVD;}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{namespace\ }internal\ \{}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ \_MatrixType>\ }
\DoxyCodeLine{00036\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_eigen_1_1internal_1_1traits}{traits}}<\mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d}{BDCSVD}}<\_MatrixType>\ >}
\DoxyCodeLine{00037\ \{}
\DoxyCodeLine{00038\ \ \ \textcolor{keyword}{typedef}\ \_MatrixType\ MatrixType;}
\DoxyCodeLine{00039\ \};\ \ }
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \}\ \textcolor{comment}{//\ end\ namespace\ internal}}
\DoxyCodeLine{00042\ \ \ }
\DoxyCodeLine{00043\ \ \ }
\DoxyCodeLine{00066\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ \_MatrixType>\ }
\DoxyCodeLine{00067\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d}{BDCSVD}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base}{SVDBase}}<BDCSVD<\_MatrixType>\ >}
\DoxyCodeLine{00068\ \{}
\DoxyCodeLine{00069\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base}{SVDBase<BDCSVD>}}\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base}{Base}};}
\DoxyCodeLine{00070\ \ \ \ \ }
\DoxyCodeLine{00071\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00072\ \ \ \textcolor{keyword}{using\ }Base::rows;}
\DoxyCodeLine{00073\ \ \ \textcolor{keyword}{using\ }Base::cols;}
\DoxyCodeLine{00074\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a705a7c2709e1624ccc19aa748a78d473}{Base::computeU}};}
\DoxyCodeLine{00075\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a5f12efcb791eb007d4a4890ac5255ac4}{Base::computeV}};}
\DoxyCodeLine{00076\ \ \ }
\DoxyCodeLine{00077\ \ \ \textcolor{keyword}{typedef}\ \_MatrixType\ MatrixType;}
\DoxyCodeLine{00078\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ MatrixType::Scalar\ Scalar;}
\DoxyCodeLine{00079\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ NumTraits<typename\ MatrixType::Scalar>::Real\ RealScalar;}
\DoxyCodeLine{00080\ \ \ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{00081\ \ \ \ \ RowsAtCompileTime\ =\ MatrixType::RowsAtCompileTime,\ }
\DoxyCodeLine{00082\ \ \ \ \ ColsAtCompileTime\ =\ MatrixType::ColsAtCompileTime,\ }
\DoxyCodeLine{00083\ \ \ \ \ DiagSizeAtCompileTime\ =\ EIGEN\_SIZE\_MIN\_PREFER\_DYNAMIC(RowsAtCompileTime,\ ColsAtCompileTime),\ }
\DoxyCodeLine{00084\ \ \ \ \ MaxRowsAtCompileTime\ =\ MatrixType::MaxRowsAtCompileTime,\ }
\DoxyCodeLine{00085\ \ \ \ \ MaxColsAtCompileTime\ =\ MatrixType::MaxColsAtCompileTime,\ }
\DoxyCodeLine{00086\ \ \ \ \ MaxDiagSizeAtCompileTime\ =\ EIGEN\_SIZE\_MIN\_PREFER\_FIXED(MaxRowsAtCompileTime,\ MaxColsAtCompileTime),\ }
\DoxyCodeLine{00087\ \ \ \ \ MatrixOptions\ =\ MatrixType::Options}
\DoxyCodeLine{00088\ \ \ \};}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{Base::MatrixUType}}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{MatrixUType}};}
\DoxyCodeLine{00091\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{Base::MatrixVType}}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{MatrixVType}};}
\DoxyCodeLine{00092\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{struct_eigen_1_1internal_1_1true__type}{Base::SingularValuesType}}\ \mbox{\hyperlink{struct_eigen_1_1internal_1_1true__type}{SingularValuesType}};}
\DoxyCodeLine{00093\ \ \ }
\DoxyCodeLine{00094\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{Matrix<Scalar,\ Dynamic,\ Dynamic,\ ColMajor>}}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{MatrixX}};}
\DoxyCodeLine{00095\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{Matrix<RealScalar,\ Dynamic,\ Dynamic,\ ColMajor>}}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{MatrixXr}};}
\DoxyCodeLine{00096\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{Matrix<RealScalar,\ Dynamic,\ 1>}}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{VectorType}};}
\DoxyCodeLine{00097\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_eigen_1_1_array}{Array<RealScalar,\ Dynamic,\ 1>}}\ \mbox{\hyperlink{class_eigen_1_1_array}{ArrayXr}};}
\DoxyCodeLine{00098\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_eigen_1_1_array}{Array<Index,1,Dynamic>}}\ \mbox{\hyperlink{class_eigen_1_1_array}{ArrayXi}};}
\DoxyCodeLine{00099\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_eigen_1_1_ref}{Ref<ArrayXr>}}\ \mbox{\hyperlink{class_eigen_1_1_ref}{ArrayRef}};}
\DoxyCodeLine{00100\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_eigen_1_1_ref}{Ref<ArrayXi>}}\ \mbox{\hyperlink{class_eigen_1_1_ref}{IndicesRef}};}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00107\ \ \ \mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d_a39514816d38f9c418cf3f3514b511c2c}{BDCSVD}}()\ :\ m\_algoswap(16),\ m\_numIters(0)}
\DoxyCodeLine{00108\ \ \ \{\}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00117\ \ \ \mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d_a3e1fa48b3d042b7daf7392724a68bb60}{BDCSVD}}(Index\ rows,\ Index\ cols,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ computationOptions\ =\ 0)}
\DoxyCodeLine{00118\ \ \ \ \ :\ m\_algoswap(16),\ m\_numIters(0)}
\DoxyCodeLine{00119\ \ \ \{}
\DoxyCodeLine{00120\ \ \ \ \ allocate(rows,\ cols,\ computationOptions);}
\DoxyCodeLine{00121\ \ \ \}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00133\ \ \ \mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d_a302746d9c534cd513c1df87c7ae4850d}{BDCSVD}}(\textcolor{keyword}{const}\ MatrixType\&\ matrix,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ computationOptions\ =\ 0)}
\DoxyCodeLine{00134\ \ \ \ \ :\ m\_algoswap(16),\ m\_numIters(0)}
\DoxyCodeLine{00135\ \ \ \{}
\DoxyCodeLine{00136\ \ \ \ \ \mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d_a52e3c627775010775c64d16a00cdb770}{compute}}(matrix,\ computationOptions);}
\DoxyCodeLine{00137\ \ \ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d}{\string~BDCSVD}}()\ }
\DoxyCodeLine{00140\ \ \ \{}
\DoxyCodeLine{00141\ \ \ \}}
\DoxyCodeLine{00142\ \ \ }
\DoxyCodeLine{00153\ \ \ \mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d_a39514816d38f9c418cf3f3514b511c2c}{BDCSVD}}\&\ \mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d_a52e3c627775010775c64d16a00cdb770}{compute}}(\textcolor{keyword}{const}\ MatrixType\&\ matrix,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ computationOptions);}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00161\ \ \ \mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d}{BDCSVD}}\&\ \mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d_a61880a5f6dbf7a14f91be80eaa3a22bc}{compute}}(\textcolor{keyword}{const}\ MatrixType\&\ matrix)}
\DoxyCodeLine{00162\ \ \ \{}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d_a52e3c627775010775c64d16a00cdb770}{compute}}(matrix,\ this-\/>m\_computationOptions);}
\DoxyCodeLine{00164\ \ \ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \textcolor{keywordtype}{void}\ setSwitchSize(\textcolor{keywordtype}{int}\ s)\ }
\DoxyCodeLine{00167\ \ \ \{}
\DoxyCodeLine{00168\ \ \ \ \ eigen\_assert(s>3\ \&\&\ \textcolor{stringliteral}{"{}BDCSVD\ the\ size\ of\ the\ algo\ switch\ has\ to\ be\ greater\ than\ 3"{}});}
\DoxyCodeLine{00169\ \ \ \ \ m\_algoswap\ =\ s;}
\DoxyCodeLine{00170\ \ \ \}}
\DoxyCodeLine{00171\ \ }
\DoxyCodeLine{00172\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00173\ \ \ \textcolor{keywordtype}{void}\ allocate(\mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ rows,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ cols,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ computationOptions);}
\DoxyCodeLine{00174\ \ \ \textcolor{keywordtype}{void}\ divide(\mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ firstCol,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ lastCol,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ firstRowW,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ firstColW,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ shift);}
\DoxyCodeLine{00175\ \ \ \textcolor{keywordtype}{void}\ computeSVDofM(\mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ firstCol,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ n,\ MatrixXr\&\ U,\ VectorType\&\ singVals,\ MatrixXr\&\ V);}
\DoxyCodeLine{00176\ \ \ \textcolor{keywordtype}{void}\ computeSingVals(\textcolor{keyword}{const}\ ArrayRef\&\ col0,\ \textcolor{keyword}{const}\ ArrayRef\&\ diag,\ \textcolor{keyword}{const}\ IndicesRef\&\ perm,\ VectorType\&\ singVals,\ ArrayRef\ shifts,\ ArrayRef\ mus);}
\DoxyCodeLine{00177\ \ \ \textcolor{keywordtype}{void}\ perturbCol0(\textcolor{keyword}{const}\ ArrayRef\&\ col0,\ \textcolor{keyword}{const}\ ArrayRef\&\ diag,\ \textcolor{keyword}{const}\ IndicesRef\&\ perm,\ \textcolor{keyword}{const}\ VectorType\&\ singVals,\ \textcolor{keyword}{const}\ ArrayRef\&\ shifts,\ \textcolor{keyword}{const}\ ArrayRef\&\ mus,\ ArrayRef\ zhat);}
\DoxyCodeLine{00178\ \ \ \textcolor{keywordtype}{void}\ computeSingVecs(\textcolor{keyword}{const}\ ArrayRef\&\ zhat,\ \textcolor{keyword}{const}\ ArrayRef\&\ diag,\ \textcolor{keyword}{const}\ IndicesRef\&\ perm,\ \textcolor{keyword}{const}\ VectorType\&\ singVals,\ \textcolor{keyword}{const}\ ArrayRef\&\ shifts,\ \textcolor{keyword}{const}\ ArrayRef\&\ mus,\ MatrixXr\&\ U,\ MatrixXr\&\ V);}
\DoxyCodeLine{00179\ \ \ \textcolor{keywordtype}{void}\ deflation43(\mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ firstCol,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ shift,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ i,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ size);}
\DoxyCodeLine{00180\ \ \ \textcolor{keywordtype}{void}\ deflation44(\mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ firstColu\ ,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ firstColm,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ firstRowW,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ firstColW,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ i,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ j,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ size);}
\DoxyCodeLine{00181\ \ \ \textcolor{keywordtype}{void}\ deflation(\mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ firstCol,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ lastCol,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ k,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ firstRowW,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ firstColW,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ shift);}
\DoxyCodeLine{00182\ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ HouseholderU,\ \textcolor{keyword}{typename}\ HouseholderV,\ \textcolor{keyword}{typename}\ NaiveU,\ \textcolor{keyword}{typename}\ NaiveV>}
\DoxyCodeLine{00183\ \ \ \textcolor{keywordtype}{void}\ copyUV(\textcolor{keyword}{const}\ HouseholderU\ \&householderU,\ \textcolor{keyword}{const}\ HouseholderV\ \&householderV,\ \textcolor{keyword}{const}\ NaiveU\ \&naiveU,\ \textcolor{keyword}{const}\ NaiveV\ \&naivev);}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordtype}{void}\ structured\_update(Block<MatrixXr,Dynamic,Dynamic>\ A,\ \textcolor{keyword}{const}\ MatrixXr\ \&B,\ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ n1);}
\DoxyCodeLine{00185\ \ \ \textcolor{keyword}{static}\ RealScalar\ secularEq(RealScalar\ x,\ \textcolor{keyword}{const}\ ArrayRef\&\ col0,\ \textcolor{keyword}{const}\ ArrayRef\&\ diag,\ \textcolor{keyword}{const}\ IndicesRef\ \&perm,\ \textcolor{keyword}{const}\ ArrayRef\&\ diagShifted,\ RealScalar\ shift);}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00188\ \ \ MatrixXr\ m\_naiveU,\ m\_naiveV;}
\DoxyCodeLine{00189\ \ \ MatrixXr\ m\_computed;}
\DoxyCodeLine{00190\ \ \ \mbox{\hyperlink{class_eigen_1_1_s_v_d_base_a6229a37997eca1072b52cca5ee7a2bec}{Index}}\ m\_nRec;}
\DoxyCodeLine{00191\ \ \ ArrayXr\ m\_workspace;}
\DoxyCodeLine{00192\ \ \ ArrayXi\ m\_workspaceI;}
\DoxyCodeLine{00193\ \ \ \textcolor{keywordtype}{int}\ m\_algoswap;}
\DoxyCodeLine{00194\ \ \ \textcolor{keywordtype}{bool}\ m\_isTranspose,\ m\_compU,\ m\_compV;}
\DoxyCodeLine{00195\ \ \ }
\DoxyCodeLine{00196\ \ \ \textcolor{keyword}{using\ }Base::m\_singularValues;}
\DoxyCodeLine{00197\ \ \ \textcolor{keyword}{using\ }Base::m\_diagSize;}
\DoxyCodeLine{00198\ \ \ \textcolor{keyword}{using\ }Base::m\_computeFullU;}
\DoxyCodeLine{00199\ \ \ \textcolor{keyword}{using\ }Base::m\_computeFullV;}
\DoxyCodeLine{00200\ \ \ \textcolor{keyword}{using\ }Base::m\_computeThinU;}
\DoxyCodeLine{00201\ \ \ \textcolor{keyword}{using\ }Base::m\_computeThinV;}
\DoxyCodeLine{00202\ \ \ \textcolor{keyword}{using\ }Base::m\_matrixU;}
\DoxyCodeLine{00203\ \ \ \textcolor{keyword}{using\ }Base::m\_matrixV;}
\DoxyCodeLine{00204\ \ \ \textcolor{keyword}{using\ }Base::m\_isInitialized;}
\DoxyCodeLine{00205\ \ \ \textcolor{keyword}{using\ }Base::m\_nonzeroSingularValues;}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \textcolor{keyword}{public}:\ \ }
\DoxyCodeLine{00208\ \ \ \textcolor{keywordtype}{int}\ m\_numIters;}
\DoxyCodeLine{00209\ \};\ \textcolor{comment}{//end\ class\ BDCSVD}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \textcolor{comment}{//\ Method\ to\ allocate\ and\ initialize\ matrix\ and\ attributes}}
\DoxyCodeLine{00213\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00214\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::allocate(Index\ rows,\ Index\ cols,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ computationOptions)}
\DoxyCodeLine{00215\ \{}
\DoxyCodeLine{00216\ \ \ m\_isTranspose\ =\ (cols\ >\ rows);}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \textcolor{keywordflow}{if}\ (Base::allocate(rows,\ cols,\ computationOptions))}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00220\ \ \ }
\DoxyCodeLine{00221\ \ \ m\_computed\ =\ MatrixXr::Zero(m\_diagSize\ +\ 1,\ m\_diagSize\ );}
\DoxyCodeLine{00222\ \ \ m\_compU\ =\ computeV();}
\DoxyCodeLine{00223\ \ \ m\_compV\ =\ computeU();}
\DoxyCodeLine{00224\ \ \ \textcolor{keywordflow}{if}\ (m\_isTranspose)}
\DoxyCodeLine{00225\ \ \ \ \ std::swap(m\_compU,\ m\_compV);}
\DoxyCodeLine{00226\ \ \ }
\DoxyCodeLine{00227\ \ \ \textcolor{keywordflow}{if}\ (m\_compU)\ m\_naiveU\ =\ MatrixXr::Zero(m\_diagSize\ +\ 1,\ m\_diagSize\ +\ 1\ );}
\DoxyCodeLine{00228\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ m\_naiveU\ =\ MatrixXr::Zero(2,\ m\_diagSize\ +\ 1\ );}
\DoxyCodeLine{00229\ \ \ }
\DoxyCodeLine{00230\ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ m\_naiveV\ =\ MatrixXr::Zero(m\_diagSize,\ m\_diagSize);}
\DoxyCodeLine{00231\ \ \ }
\DoxyCodeLine{00232\ \ \ m\_workspace.resize((m\_diagSize+1)*(m\_diagSize+1)*3);}
\DoxyCodeLine{00233\ \ \ m\_workspaceI.resize(3*m\_diagSize);}
\DoxyCodeLine{00234\ \}\textcolor{comment}{//\ end\ allocate}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00237\ \mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d}{BDCSVD<MatrixType>}}\&\ \mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d_a52e3c627775010775c64d16a00cdb770}{BDCSVD<MatrixType>::compute}}(\textcolor{keyword}{const}\ MatrixType\&\ matrix,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ computationOptions)\ }
\DoxyCodeLine{00238\ \{}
\DoxyCodeLine{00239\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00240\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n\(\backslash\)n======================================================================================================================\(\backslash\)n\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00241\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00242\ \ \ allocate(matrix.rows(),\ matrix.cols(),\ computationOptions);}
\DoxyCodeLine{00243\ \ \ \textcolor{keyword}{using\ }std::abs;}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \textcolor{keyword}{const}\ RealScalar\ considerZero\ =\ (std::numeric\_limits<RealScalar>::min)();}
\DoxyCodeLine{00246\ \ \ }
\DoxyCodeLine{00247\ \ \ \textcolor{comment}{//****\ step\ -\/1\ -\/\ If\ the\ problem\ is\ too\ small,\ directly\ falls\ back\ to\ JacobiSVD\ and\ return}}
\DoxyCodeLine{00248\ \ \ \textcolor{keywordflow}{if}(matrix.cols()\ <\ m\_algoswap)}
\DoxyCodeLine{00249\ \ \ \{}
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{comment}{//\ FIXME\ this\ line\ involves\ temporaries}}
\DoxyCodeLine{00251\ \ \ \ \ \mbox{\hyperlink{class_eigen_1_1_jacobi_s_v_d}{JacobiSVD<MatrixType>}}\ jsvd(matrix,computationOptions);}
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{keywordflow}{if}(computeU())\ m\_matrixU\ =\ jsvd.\mbox{\hyperlink{class_eigen_1_1_s_v_d_base_accbc8e3f9baab3a57a6eba8e4cc3ea27}{matrixU}}();}
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{keywordflow}{if}(computeV())\ m\_matrixV\ =\ jsvd.\mbox{\hyperlink{class_eigen_1_1_s_v_d_base_af09f06357d7d7442f7ca7343713756fe}{matrixV}}();}
\DoxyCodeLine{00254\ \ \ \ \ m\_singularValues\ =\ jsvd.\mbox{\hyperlink{class_eigen_1_1_s_v_d_base_ac44c307a70731003003faf3a9bdf14f6}{singularValues}}();}
\DoxyCodeLine{00255\ \ \ \ \ m\_nonzeroSingularValues\ =\ jsvd.\mbox{\hyperlink{class_eigen_1_1_s_v_d_base_afe8a555f38393a319a71ec0f0331c9ef}{nonzeroSingularValues}}();}
\DoxyCodeLine{00256\ \ \ \ \ m\_isInitialized\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00258\ \ \ \}}
\DoxyCodeLine{00259\ \ \ }
\DoxyCodeLine{00260\ \ \ \textcolor{comment}{//****\ step\ 0\ -\/\ Copy\ the\ input\ matrix\ and\ apply\ scaling\ to\ reduce\ over/under-\/flows}}
\DoxyCodeLine{00261\ \ \ RealScalar\ scale\ =\ matrix.cwiseAbs().maxCoeff();}
\DoxyCodeLine{00262\ \ \ \textcolor{keywordflow}{if}(scale==RealScalar(0))\ scale\ =\ RealScalar(1);}
\DoxyCodeLine{00263\ \ \ \mbox{\hyperlink{class_eigen_1_1_matrix}{MatrixX}}\ copy;}
\DoxyCodeLine{00264\ \ \ \textcolor{keywordflow}{if}\ (m\_isTranspose)\ copy\ =\ matrix.adjoint()/scale;}
\DoxyCodeLine{00265\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ copy\ =\ matrix/scale;}
\DoxyCodeLine{00266\ \ \ }
\DoxyCodeLine{00267\ \ \ \textcolor{comment}{//****\ step\ 1\ -\/\ Bidiagonalization}}
\DoxyCodeLine{00268\ \ \ \textcolor{comment}{//\ FIXME\ this\ line\ involves\ temporaries}}
\DoxyCodeLine{00269\ \ \ \mbox{\hyperlink{class_eigen_1_1internal_1_1_upper_bidiagonalization}{internal::UpperBidiagonalization<MatrixX>}}\ bid(copy);}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \textcolor{comment}{//****\ step\ 2\ -\/\ Divide\ \&\ Conquer}}
\DoxyCodeLine{00272\ \ \ m\_naiveU.setZero();}
\DoxyCodeLine{00273\ \ \ m\_naiveV.setZero();}
\DoxyCodeLine{00274\ \ \ \textcolor{comment}{//\ FIXME\ this\ line\ involves\ a\ temporary\ matrix}}
\DoxyCodeLine{00275\ \ \ m\_computed.topRows(m\_diagSize)\ =\ bid.bidiagonal().toDenseMatrix().transpose();}
\DoxyCodeLine{00276\ \ \ m\_computed.template\ bottomRows<1>().\mbox{\hyperlink{class_eigen_1_1_plain_object_base_ab8b732ae4d45271b2532978ee13210d1}{setZero}}();}
\DoxyCodeLine{00277\ \ \ divide(0,\ m\_diagSize\ -\/\ 1,\ 0,\ 0,\ 0);}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \ \ \textcolor{comment}{//****\ step\ 3\ -\/\ Copy\ singular\ values\ and\ vectors}}
\DoxyCodeLine{00280\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<m\_diagSize;\ i++)}
\DoxyCodeLine{00281\ \ \ \{}
\DoxyCodeLine{00282\ \ \ \ \ RealScalar\ a\ =\ abs(m\_computed.coeff(i,\ i));}
\DoxyCodeLine{00283\ \ \ \ \ m\_singularValues.coeffRef(i)\ =\ a\ *\ scale;}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{keywordflow}{if}\ (a<considerZero)}
\DoxyCodeLine{00285\ \ \ \ \ \{}
\DoxyCodeLine{00286\ \ \ \ \ \ \ m\_nonzeroSingularValues\ =\ i;}
\DoxyCodeLine{00287\ \ \ \ \ \ \ m\_singularValues.tail(m\_diagSize\ -\/\ i\ -\/\ 1).setZero();}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00289\ \ \ \ \ \}}
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (i\ ==\ m\_diagSize\ -\/\ 1)}
\DoxyCodeLine{00291\ \ \ \ \ \{}
\DoxyCodeLine{00292\ \ \ \ \ \ \ m\_nonzeroSingularValues\ =\ i\ +\ 1;}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00294\ \ \ \ \ \}}
\DoxyCodeLine{00295\ \ \ \}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00298\ \textcolor{comment}{//\ \ \ std::cout\ <<\ "{}m\_naiveU\(\backslash\)n"{}\ <<\ m\_naiveU\ <<\ "{}\(\backslash\)n\(\backslash\)n"{};}}
\DoxyCodeLine{00299\ \textcolor{comment}{//\ \ \ std::cout\ <<\ "{}m\_naiveV\(\backslash\)n"{}\ <<\ m\_naiveV\ <<\ "{}\(\backslash\)n\(\backslash\)n"{};}}
\DoxyCodeLine{00300\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00301\ \ \ \textcolor{keywordflow}{if}(m\_isTranspose)\ copyUV(bid.householderV(),\ bid.householderU(),\ m\_naiveV,\ m\_naiveU);}
\DoxyCodeLine{00302\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ copyUV(bid.householderU(),\ bid.householderV(),\ m\_naiveU,\ m\_naiveV);}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ m\_isInitialized\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00305\ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00306\ \}\textcolor{comment}{//\ end\ compute}}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00310\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ HouseholderU,\ \textcolor{keyword}{typename}\ HouseholderV,\ \textcolor{keyword}{typename}\ NaiveU,\ \textcolor{keyword}{typename}\ NaiveV>}
\DoxyCodeLine{00311\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d}{BDCSVD<MatrixType>::copyUV}}(\textcolor{keyword}{const}\ HouseholderU\ \&householderU,\ \textcolor{keyword}{const}\ HouseholderV\ \&householderV,\ \textcolor{keyword}{const}\ NaiveU\ \&naiveU,\ \textcolor{keyword}{const}\ NaiveV\ \&naiveV)}
\DoxyCodeLine{00312\ \{}
\DoxyCodeLine{00313\ \ \ \textcolor{comment}{//\ Note\ exchange\ of\ U\ and\ V:\ m\_matrixU\ is\ set\ from\ m\_naiveV\ and\ vice\ versa}}
\DoxyCodeLine{00314\ \ \ \textcolor{keywordflow}{if}\ (computeU())}
\DoxyCodeLine{00315\ \ \ \{}
\DoxyCodeLine{00316\ \ \ \ \ Index\ Ucols\ =\ m\_computeThinU\ ?\ m\_diagSize\ :\ householderU.cols();}
\DoxyCodeLine{00317\ \ \ \ \ m\_matrixU\ =\ MatrixX::Identity(householderU.cols(),\ Ucols);}
\DoxyCodeLine{00318\ \ \ \ \ m\_matrixU.topLeftCorner(m\_diagSize,\ m\_diagSize)\ =\ naiveV.template\ cast<Scalar>().topLeftCorner(m\_diagSize,\ m\_diagSize);}
\DoxyCodeLine{00319\ \ \ \ \ householderU.applyThisOnTheLeft(m\_matrixU);\ \textcolor{comment}{//\ FIXME\ this\ line\ involves\ a\ temporary\ buffer}}
\DoxyCodeLine{00320\ \ \ \}}
\DoxyCodeLine{00321\ \ \ \textcolor{keywordflow}{if}\ (computeV())}
\DoxyCodeLine{00322\ \ \ \{}
\DoxyCodeLine{00323\ \ \ \ \ Index\ Vcols\ =\ m\_computeThinV\ ?\ m\_diagSize\ :\ householderV.cols();}
\DoxyCodeLine{00324\ \ \ \ \ m\_matrixV\ =\ MatrixX::Identity(householderV.cols(),\ Vcols);}
\DoxyCodeLine{00325\ \ \ \ \ m\_matrixV.topLeftCorner(m\_diagSize,\ m\_diagSize)\ =\ naiveU.template\ cast<Scalar>().topLeftCorner(m\_diagSize,\ m\_diagSize);}
\DoxyCodeLine{00326\ \ \ \ \ householderV.applyThisOnTheLeft(m\_matrixV);\ \textcolor{comment}{//\ FIXME\ this\ line\ involves\ a\ temporary\ buffer}}
\DoxyCodeLine{00327\ \ \ \}}
\DoxyCodeLine{00328\ \}}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00338\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00339\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::structured\_update(Block<MatrixXr,Dynamic,Dynamic>\ A,\ \textcolor{keyword}{const}\ MatrixXr\ \&B,\ Index\ n1)}
\DoxyCodeLine{00340\ \{}
\DoxyCodeLine{00341\ \ \ Index\ n\ =\ A.rows();}
\DoxyCodeLine{00342\ \ \ \textcolor{keywordflow}{if}(n>100)}
\DoxyCodeLine{00343\ \ \ \{}
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{comment}{//\ If\ the\ matrices\ are\ large\ enough,\ let's\ exploit\ the\ sparse\ structure\ of\ A\ by}}
\DoxyCodeLine{00345\ \ \ \ \ \textcolor{comment}{//\ splitting\ it\ in\ half\ (wrt\ n1),\ and\ packing\ the\ non-\/zero\ columns.}}
\DoxyCodeLine{00346\ \ \ \ \ Index\ n2\ =\ n\ -\/\ n1;}
\DoxyCodeLine{00347\ \ \ \ \ Map<MatrixXr>\ A1(m\_workspace.data()\ \ \ \ \ \ ,\ n1,\ n);}
\DoxyCodeLine{00348\ \ \ \ \ Map<MatrixXr>\ A2(m\_workspace.data()+\ n1*n,\ n2,\ n);}
\DoxyCodeLine{00349\ \ \ \ \ Map<MatrixXr>\ B1(m\_workspace.data()+\ \ n*n,\ n,\ \ n);}
\DoxyCodeLine{00350\ \ \ \ \ Map<MatrixXr>\ B2(m\_workspace.data()+2*n*n,\ n,\ \ n);}
\DoxyCodeLine{00351\ \ \ \ \ Index\ k1=0,\ k2=0;}
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{keywordflow}{for}(Index\ j=0;\ j<n;\ ++j)}
\DoxyCodeLine{00353\ \ \ \ \ \{}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ (A.col(j).head(n1).array()!=0).any()\ )}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ A1.col(k1)\ =\ A.col(j).head(n1);}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ B1.row(k1)\ =\ B.row(j);}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ ++k1;}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ (A.col(j).tail(n2).array()!=0).any()\ )}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ A2.col(k2)\ =\ A.col(j).tail(n2);}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ B2.row(k2)\ =\ B.row(j);}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ ++k2;}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00366\ \ \ \ \ \}}
\DoxyCodeLine{00367\ \ \ }
\DoxyCodeLine{00368\ \ \ \ \ A.topRows(n1).noalias()\ \ \ \ =\ A1.leftCols(k1)\ *\ B1.topRows(k1);}
\DoxyCodeLine{00369\ \ \ \ \ A.bottomRows(n2).noalias()\ =\ A2.leftCols(k2)\ *\ B2.topRows(k2);}
\DoxyCodeLine{00370\ \ \ \}}
\DoxyCodeLine{00371\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00372\ \ \ \{}
\DoxyCodeLine{00373\ \ \ \ \ Map<MatrixXr,Aligned>\ tmp(m\_workspace.data(),n,n);}
\DoxyCodeLine{00374\ \ \ \ \ tmp.noalias()\ =\ A*B;}
\DoxyCodeLine{00375\ \ \ \ \ A\ =\ tmp;}
\DoxyCodeLine{00376\ \ \ \}}
\DoxyCodeLine{00377\ \}}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \textcolor{comment}{//\ The\ divide\ algorithm\ is\ done\ "{}in\ place"{},\ we\ are\ always\ working\ on\ subsets\ of\ the\ same\ matrix.\ The\ divide\ methods\ takes\ as\ argument\ the\ }}
\DoxyCodeLine{00380\ \textcolor{comment}{//\ place\ of\ the\ submatrix\ we\ are\ currently\ working\ on.}}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \textcolor{comment}{//@param\ firstCol\ :\ The\ Index\ of\ the\ first\ column\ of\ the\ submatrix\ of\ m\_computed\ and\ for\ m\_naiveU;}}
\DoxyCodeLine{00383\ \textcolor{comment}{//@param\ lastCol\ :\ The\ Index\ of\ the\ last\ column\ of\ the\ submatrix\ of\ m\_computed\ and\ for\ m\_naiveU;\ }}
\DoxyCodeLine{00384\ \textcolor{comment}{//\ lastCol\ +\ 1\ -\/\ firstCol\ is\ the\ size\ of\ the\ submatrix.}}
\DoxyCodeLine{00385\ \textcolor{comment}{//@param\ firstRowW\ :\ The\ Index\ of\ the\ first\ row\ of\ the\ matrix\ W\ that\ we\ are\ to\ change.\ (see\ the\ reference\ paper\ section\ 1\ for\ more\ information\ on\ W)}}
\DoxyCodeLine{00386\ \textcolor{comment}{//@param\ firstRowW\ :\ Same\ as\ firstRowW\ with\ the\ column.}}
\DoxyCodeLine{00387\ \textcolor{comment}{//@param\ shift\ :\ Each\ time\ one\ takes\ the\ left\ submatrix,\ one\ must\ add\ 1\ to\ the\ shift.\ Why?\ Because!\ We\ actually\ want\ the\ last\ column\ of\ the\ U\ submatrix\ }}
\DoxyCodeLine{00388\ \textcolor{comment}{//\ to\ become\ the\ first\ column\ (*coeff)\ and\ to\ shift\ all\ the\ other\ columns\ to\ the\ right.\ There\ are\ more\ details\ on\ the\ reference\ paper.}}
\DoxyCodeLine{00389\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00390\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::divide\ (Index\ firstCol,\ Index\ lastCol,\ Index\ firstRowW,\ Index\ firstColW,\ Index\ shift)}
\DoxyCodeLine{00391\ \{}
\DoxyCodeLine{00392\ \ \ \textcolor{comment}{//\ requires\ rows\ =\ cols\ +\ 1;}}
\DoxyCodeLine{00393\ \ \ \textcolor{keyword}{using\ }std::pow;}
\DoxyCodeLine{00394\ \ \ \textcolor{keyword}{using\ }std::sqrt;}
\DoxyCodeLine{00395\ \ \ \textcolor{keyword}{using\ }std::abs;}
\DoxyCodeLine{00396\ \ \ \textcolor{keyword}{const}\ Index\ n\ =\ lastCol\ -\/\ firstCol\ +\ 1;}
\DoxyCodeLine{00397\ \ \ \textcolor{keyword}{const}\ Index\ k\ =\ n/2;}
\DoxyCodeLine{00398\ \ \ \textcolor{keyword}{const}\ RealScalar\ considerZero\ =\ (std::numeric\_limits<RealScalar>::min)();}
\DoxyCodeLine{00399\ \ \ RealScalar\ alphaK;}
\DoxyCodeLine{00400\ \ \ RealScalar\ betaK;\ }
\DoxyCodeLine{00401\ \ \ RealScalar\ r0;\ }
\DoxyCodeLine{00402\ \ \ RealScalar\ lambda,\ phi,\ c0,\ s0;}
\DoxyCodeLine{00403\ \ \ VectorType\ l,\ f;}
\DoxyCodeLine{00404\ \ \ \textcolor{comment}{//\ We\ use\ the\ other\ algorithm\ which\ is\ more\ efficient\ for\ small\ }}
\DoxyCodeLine{00405\ \ \ \textcolor{comment}{//\ matrices.}}
\DoxyCodeLine{00406\ \ \ \textcolor{keywordflow}{if}\ (n\ <\ m\_algoswap)}
\DoxyCodeLine{00407\ \ \ \{}
\DoxyCodeLine{00408\ \ \ \ \ \textcolor{comment}{//\ FIXME\ this\ line\ involves\ temporaries}}
\DoxyCodeLine{00409\ \ \ \ \ JacobiSVD<MatrixXr>\ b(m\_computed.block(firstCol,\ firstCol,\ n\ +\ 1,\ n),\ \mbox{\hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a9fa9302d510cee20c26311154937e23f}{ComputeFullU}}\ |\ (m\_compV\ ?\ \mbox{\hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a36581f7c662f7def31efd500c284f930}{ComputeFullV}}\ :\ 0));}
\DoxyCodeLine{00410\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_compU)}
\DoxyCodeLine{00411\ \ \ \ \ \ \ m\_naiveU.block(firstCol,\ firstCol,\ n\ +\ 1,\ n\ +\ 1).real()\ =\ b.matrixU();}
\DoxyCodeLine{00412\ \ \ \ \ \textcolor{keywordflow}{else}\ }
\DoxyCodeLine{00413\ \ \ \ \ \{}
\DoxyCodeLine{00414\ \ \ \ \ \ \ m\_naiveU.row(0).segment(firstCol,\ n\ +\ 1).real()\ =\ b.matrixU().row(0);}
\DoxyCodeLine{00415\ \ \ \ \ \ \ m\_naiveU.row(1).segment(firstCol,\ n\ +\ 1).real()\ =\ b.matrixU().row(n);}
\DoxyCodeLine{00416\ \ \ \ \ \}}
\DoxyCodeLine{00417\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ m\_naiveV.block(firstRowW,\ firstColW,\ n,\ n).real()\ =\ b.matrixV();}
\DoxyCodeLine{00418\ \ \ \ \ m\_computed.block(firstCol\ +\ shift,\ firstCol\ +\ shift,\ n\ +\ 1,\ n).setZero();}
\DoxyCodeLine{00419\ \ \ \ \ m\_computed.diagonal().segment(firstCol\ +\ shift,\ n)\ =\ b.singularValues().head(n);}
\DoxyCodeLine{00420\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00421\ \ \ \}}
\DoxyCodeLine{00422\ \ \ \textcolor{comment}{//\ We\ use\ the\ divide\ and\ conquer\ algorithm}}
\DoxyCodeLine{00423\ \ \ alphaK\ =\ \ m\_computed(firstCol\ +\ k,\ firstCol\ +\ k);}
\DoxyCodeLine{00424\ \ \ betaK\ =\ m\_computed(firstCol\ +\ k\ +\ 1,\ firstCol\ +\ k);}
\DoxyCodeLine{00425\ \ \ \textcolor{comment}{//\ The\ divide\ must\ be\ done\ in\ that\ order\ in\ order\ to\ have\ good\ results.\ Divide\ change\ the\ data\ inside\ the\ submatrices}}
\DoxyCodeLine{00426\ \ \ \textcolor{comment}{//\ and\ the\ divide\ of\ the\ right\ submatrice\ reads\ one\ column\ of\ the\ left\ submatrice.\ That's\ why\ we\ need\ to\ treat\ the\ }}
\DoxyCodeLine{00427\ \ \ \textcolor{comment}{//\ right\ submatrix\ before\ the\ left\ one.\ }}
\DoxyCodeLine{00428\ \ \ divide(k\ +\ 1\ +\ firstCol,\ lastCol,\ k\ +\ 1\ +\ firstRowW,\ k\ +\ 1\ +\ firstColW,\ shift);}
\DoxyCodeLine{00429\ \ \ divide(firstCol,\ k\ -\/\ 1\ +\ firstCol,\ firstRowW,\ firstColW\ +\ 1,\ shift\ +\ 1);}
\DoxyCodeLine{00430\ }
\DoxyCodeLine{00431\ \ \ \textcolor{keywordflow}{if}\ (m\_compU)}
\DoxyCodeLine{00432\ \ \ \{}
\DoxyCodeLine{00433\ \ \ \ \ lambda\ =\ m\_naiveU(firstCol\ +\ k,\ firstCol\ +\ k);}
\DoxyCodeLine{00434\ \ \ \ \ phi\ =\ m\_naiveU(firstCol\ +\ k\ +\ 1,\ lastCol\ +\ 1);}
\DoxyCodeLine{00435\ \ \ \}\ }
\DoxyCodeLine{00436\ \ \ \textcolor{keywordflow}{else}\ }
\DoxyCodeLine{00437\ \ \ \{}
\DoxyCodeLine{00438\ \ \ \ \ lambda\ =\ m\_naiveU(1,\ firstCol\ +\ k);}
\DoxyCodeLine{00439\ \ \ \ \ phi\ =\ m\_naiveU(0,\ lastCol\ +\ 1);}
\DoxyCodeLine{00440\ \ \ \}}
\DoxyCodeLine{00441\ \ \ r0\ =\ sqrt((abs(alphaK\ *\ lambda)\ *\ abs(alphaK\ *\ lambda))\ +\ abs(betaK\ *\ phi)\ *\ abs(betaK\ *\ phi));}
\DoxyCodeLine{00442\ \ \ \textcolor{keywordflow}{if}\ (m\_compU)}
\DoxyCodeLine{00443\ \ \ \{}
\DoxyCodeLine{00444\ \ \ \ \ l\ =\ m\_naiveU.row(firstCol\ +\ k).segment(firstCol,\ k);}
\DoxyCodeLine{00445\ \ \ \ \ f\ =\ m\_naiveU.row(firstCol\ +\ k\ +\ 1).segment(firstCol\ +\ k\ +\ 1,\ n\ -\/\ k\ -\/\ 1);}
\DoxyCodeLine{00446\ \ \ \}\ }
\DoxyCodeLine{00447\ \ \ \textcolor{keywordflow}{else}\ }
\DoxyCodeLine{00448\ \ \ \{}
\DoxyCodeLine{00449\ \ \ \ \ l\ =\ m\_naiveU.row(1).segment(firstCol,\ k);}
\DoxyCodeLine{00450\ \ \ \ \ f\ =\ m\_naiveU.row(0).segment(firstCol\ +\ k\ +\ 1,\ n\ -\/\ k\ -\/\ 1);}
\DoxyCodeLine{00451\ \ \ \}}
\DoxyCodeLine{00452\ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ m\_naiveV(firstRowW+k,\ firstColW)\ =\ 1;}
\DoxyCodeLine{00453\ \ \ \textcolor{keywordflow}{if}\ (r0<considerZero)}
\DoxyCodeLine{00454\ \ \ \{}
\DoxyCodeLine{00455\ \ \ \ \ c0\ =\ 1;}
\DoxyCodeLine{00456\ \ \ \ \ s0\ =\ 0;}
\DoxyCodeLine{00457\ \ \ \}}
\DoxyCodeLine{00458\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00459\ \ \ \{}
\DoxyCodeLine{00460\ \ \ \ \ c0\ =\ alphaK\ *\ lambda\ /\ r0;}
\DoxyCodeLine{00461\ \ \ \ \ s0\ =\ betaK\ *\ phi\ /\ r0;}
\DoxyCodeLine{00462\ \ \ \}}
\DoxyCodeLine{00463\ \ \ }
\DoxyCodeLine{00464\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00465\ \ \ assert(m\_naiveU.allFinite());}
\DoxyCodeLine{00466\ \ \ assert(m\_naiveV.allFinite());}
\DoxyCodeLine{00467\ \ \ assert(m\_computed.allFinite());}
\DoxyCodeLine{00468\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00469\ \ \ }
\DoxyCodeLine{00470\ \ \ \textcolor{keywordflow}{if}\ (m\_compU)}
\DoxyCodeLine{00471\ \ \ \{}
\DoxyCodeLine{00472\ \ \ \ \ MatrixXr\ q1\ (m\_naiveU.col(firstCol\ +\ k).segment(firstCol,\ k\ +\ 1));\ \ \ \ \ }
\DoxyCodeLine{00473\ \ \ \ \ \textcolor{comment}{//\ we\ shiftW\ Q1\ to\ the\ right}}
\DoxyCodeLine{00474\ \ \ \ \ \textcolor{keywordflow}{for}\ (Index\ i\ =\ firstCol\ +\ k\ -\/\ 1;\ i\ >=\ firstCol;\ i-\/-\/)\ }
\DoxyCodeLine{00475\ \ \ \ \ \ \ m\_naiveU.col(i\ +\ 1).segment(firstCol,\ k\ +\ 1)\ =\ m\_naiveU.col(i).segment(firstCol,\ k\ +\ 1);}
\DoxyCodeLine{00476\ \ \ \ \ \textcolor{comment}{//\ we\ shift\ q1\ at\ the\ left\ with\ a\ factor\ c0}}
\DoxyCodeLine{00477\ \ \ \ \ m\_naiveU.col(firstCol).segment(\ firstCol,\ k\ +\ 1)\ =\ (q1\ *\ c0);}
\DoxyCodeLine{00478\ \ \ \ \ \textcolor{comment}{//\ last\ column\ =\ q1\ *\ -\/\ s0}}
\DoxyCodeLine{00479\ \ \ \ \ m\_naiveU.col(lastCol\ +\ 1).segment(firstCol,\ k\ +\ 1)\ =\ (q1\ *\ (\ -\/\ s0));}
\DoxyCodeLine{00480\ \ \ \ \ \textcolor{comment}{//\ first\ column\ =\ q2\ *\ s0}}
\DoxyCodeLine{00481\ \ \ \ \ m\_naiveU.col(firstCol).segment(firstCol\ +\ k\ +\ 1,\ n\ -\/\ k)\ =\ m\_naiveU.col(lastCol\ +\ 1).segment(firstCol\ +\ k\ +\ 1,\ n\ -\/\ k)\ *\ s0;\ }
\DoxyCodeLine{00482\ \ \ \ \ \textcolor{comment}{//\ q2\ *=\ c0}}
\DoxyCodeLine{00483\ \ \ \ \ m\_naiveU.col(lastCol\ +\ 1).segment(firstCol\ +\ k\ +\ 1,\ n\ -\/\ k)\ *=\ c0;}
\DoxyCodeLine{00484\ \ \ \}\ }
\DoxyCodeLine{00485\ \ \ \textcolor{keywordflow}{else}\ }
\DoxyCodeLine{00486\ \ \ \{}
\DoxyCodeLine{00487\ \ \ \ \ RealScalar\ q1\ =\ m\_naiveU(0,\ firstCol\ +\ k);}
\DoxyCodeLine{00488\ \ \ \ \ \textcolor{comment}{//\ we\ shift\ Q1\ to\ the\ right}}
\DoxyCodeLine{00489\ \ \ \ \ \textcolor{keywordflow}{for}\ (Index\ i\ =\ firstCol\ +\ k\ -\/\ 1;\ i\ >=\ firstCol;\ i-\/-\/)\ }
\DoxyCodeLine{00490\ \ \ \ \ \ \ m\_naiveU(0,\ i\ +\ 1)\ =\ m\_naiveU(0,\ i);}
\DoxyCodeLine{00491\ \ \ \ \ \textcolor{comment}{//\ we\ shift\ q1\ at\ the\ left\ with\ a\ factor\ c0}}
\DoxyCodeLine{00492\ \ \ \ \ m\_naiveU(0,\ firstCol)\ =\ (q1\ *\ c0);}
\DoxyCodeLine{00493\ \ \ \ \ \textcolor{comment}{//\ last\ column\ =\ q1\ *\ -\/\ s0}}
\DoxyCodeLine{00494\ \ \ \ \ m\_naiveU(0,\ lastCol\ +\ 1)\ =\ (q1\ *\ (\ -\/\ s0));}
\DoxyCodeLine{00495\ \ \ \ \ \textcolor{comment}{//\ first\ column\ =\ q2\ *\ s0}}
\DoxyCodeLine{00496\ \ \ \ \ m\_naiveU(1,\ firstCol)\ =\ m\_naiveU(1,\ lastCol\ +\ 1)\ *s0;\ }
\DoxyCodeLine{00497\ \ \ \ \ \textcolor{comment}{//\ q2\ *=\ c0}}
\DoxyCodeLine{00498\ \ \ \ \ m\_naiveU(1,\ lastCol\ +\ 1)\ *=\ c0;}
\DoxyCodeLine{00499\ \ \ \ \ m\_naiveU.row(1).segment(firstCol\ +\ 1,\ k).setZero();}
\DoxyCodeLine{00500\ \ \ \ \ m\_naiveU.row(0).segment(firstCol\ +\ k\ +\ 1,\ n\ -\/\ k\ -\/\ 1).setZero();}
\DoxyCodeLine{00501\ \ \ \}}
\DoxyCodeLine{00502\ \ \ }
\DoxyCodeLine{00503\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00504\ \ \ assert(m\_naiveU.allFinite());}
\DoxyCodeLine{00505\ \ \ assert(m\_naiveV.allFinite());}
\DoxyCodeLine{00506\ \ \ assert(m\_computed.allFinite());}
\DoxyCodeLine{00507\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00508\ \ \ }
\DoxyCodeLine{00509\ \ \ m\_computed(firstCol\ +\ shift,\ firstCol\ +\ shift)\ =\ r0;}
\DoxyCodeLine{00510\ \ \ m\_computed.col(firstCol\ +\ shift).segment(firstCol\ +\ shift\ +\ 1,\ k)\ =\ alphaK\ *\ l.transpose().real();}
\DoxyCodeLine{00511\ \ \ m\_computed.col(firstCol\ +\ shift).segment(firstCol\ +\ shift\ +\ k\ +\ 1,\ n\ -\/\ k\ -\/\ 1)\ =\ betaK\ *\ f.transpose().real();}
\DoxyCodeLine{00512\ }
\DoxyCodeLine{00513\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00514\ \ \ ArrayXr\ tmp1\ =\ (m\_computed.block(firstCol+shift,\ firstCol+shift,\ n,\ n)).jacobiSvd().singularValues();}
\DoxyCodeLine{00515\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00516\ \ \ \textcolor{comment}{//\ Second\ part:\ try\ to\ deflate\ singular\ values\ in\ combined\ matrix}}
\DoxyCodeLine{00517\ \ \ deflation(firstCol,\ lastCol,\ k,\ firstRowW,\ firstColW,\ shift);}
\DoxyCodeLine{00518\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00519\ \ \ ArrayXr\ tmp2\ =\ (m\_computed.block(firstCol+shift,\ firstCol+shift,\ n,\ n)).jacobiSvd().singularValues();}
\DoxyCodeLine{00520\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)nj1\ =\ "{}}\ <<\ tmp1.transpose().format(bdcsvdfmt)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00521\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}j2\ =\ "{}}\ <<\ tmp2.transpose().format(bdcsvdfmt)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00522\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}err:\ \ \ \ \ \ "{}}\ <<\ ((tmp1-\/tmp2).abs()>1e-\/12*tmp2.abs()).transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00523\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ count\ =\ 0;}
\DoxyCodeLine{00524\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\#\ "{}}\ <<\ ++count\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00525\ \ \ assert((tmp1-\/tmp2).matrix().norm()\ <\ 1e-\/14*tmp2.matrix().norm());}
\DoxyCodeLine{00526\ \textcolor{comment}{//\ \ \ assert(count<681);}}
\DoxyCodeLine{00527\ \textcolor{comment}{//\ \ \ assert(((tmp1-\/tmp2).abs()<1e-\/13*tmp2.abs()).all());}}
\DoxyCodeLine{00528\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00529\ \ \ }
\DoxyCodeLine{00530\ \ \ \textcolor{comment}{//\ Third\ part:\ compute\ SVD\ of\ combined\ matrix}}
\DoxyCodeLine{00531\ \ \ MatrixXr\ UofSVD,\ VofSVD;}
\DoxyCodeLine{00532\ \ \ VectorType\ singVals;}
\DoxyCodeLine{00533\ \ \ computeSVDofM(firstCol\ +\ shift,\ n,\ UofSVD,\ singVals,\ VofSVD);}
\DoxyCodeLine{00534\ \ \ }
\DoxyCodeLine{00535\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00536\ \ \ assert(UofSVD.allFinite());}
\DoxyCodeLine{00537\ \ \ assert(VofSVD.allFinite());}
\DoxyCodeLine{00538\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00539\ \ \ }
\DoxyCodeLine{00540\ \ \ \textcolor{keywordflow}{if}\ (m\_compU)}
\DoxyCodeLine{00541\ \ \ \ \ structured\_update(m\_naiveU.block(firstCol,\ firstCol,\ n\ +\ 1,\ n\ +\ 1),\ UofSVD,\ (n+2)/2);}
\DoxyCodeLine{00542\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00543\ \ \ \{}
\DoxyCodeLine{00544\ \ \ \ \ Map<Matrix<RealScalar,2,Dynamic>,\mbox{\hyperlink{group__enums_gga45fe06e29902b7a2773de05ba27b47a1ae12d0f8f869c40c76128260af2242bc8}{Aligned}}>\ tmp(m\_workspace.data(),2,n+1);}
\DoxyCodeLine{00545\ \ \ \ \ tmp.noalias()\ =\ m\_naiveU.middleCols(firstCol,\ n+1)\ *\ UofSVD;}
\DoxyCodeLine{00546\ \ \ \ \ m\_naiveU.middleCols(firstCol,\ n\ +\ 1)\ =\ tmp;}
\DoxyCodeLine{00547\ \ \ \}}
\DoxyCodeLine{00548\ \ \ }
\DoxyCodeLine{00549\ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ \ structured\_update(m\_naiveV.block(firstRowW,\ firstColW,\ n,\ n),\ VofSVD,\ (n+1)/2);}
\DoxyCodeLine{00550\ \ \ }
\DoxyCodeLine{00551\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00552\ \ \ assert(m\_naiveU.allFinite());}
\DoxyCodeLine{00553\ \ \ assert(m\_naiveV.allFinite());}
\DoxyCodeLine{00554\ \ \ assert(m\_computed.allFinite());}
\DoxyCodeLine{00555\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00556\ \ \ }
\DoxyCodeLine{00557\ \ \ m\_computed.block(firstCol\ +\ shift,\ firstCol\ +\ shift,\ n,\ n).setZero();}
\DoxyCodeLine{00558\ \ \ m\_computed.block(firstCol\ +\ shift,\ firstCol\ +\ shift,\ n,\ n).diagonal()\ =\ singVals;}
\DoxyCodeLine{00559\ \}\textcolor{comment}{//\ end\ divide}}
\DoxyCodeLine{00560\ }
\DoxyCodeLine{00561\ \textcolor{comment}{//\ Compute\ SVD\ of\ m\_computed.block(firstCol,\ firstCol,\ n\ +\ 1,\ n);\ this\ block\ only\ has\ non-\/zeros\ in}}
\DoxyCodeLine{00562\ \textcolor{comment}{//\ the\ first\ column\ and\ on\ the\ diagonal\ and\ has\ undergone\ deflation,\ so\ diagonal\ is\ in\ increasing}}
\DoxyCodeLine{00563\ \textcolor{comment}{//\ order\ except\ for\ possibly\ the\ (0,0)\ entry.\ The\ computed\ SVD\ is\ stored\ U,\ singVals\ and\ V,\ except}}
\DoxyCodeLine{00564\ \textcolor{comment}{//\ that\ if\ m\_compV\ is\ false,\ then\ V\ is\ not\ computed.\ Singular\ values\ are\ sorted\ in\ decreasing\ order.}}
\DoxyCodeLine{00565\ \textcolor{comment}{//}}
\DoxyCodeLine{00566\ \textcolor{comment}{//\ TODO\ Opportunities\ for\ optimization:\ better\ root\ finding\ algo,\ better\ stopping\ criterion,\ better}}
\DoxyCodeLine{00567\ \textcolor{comment}{//\ handling\ of\ round-\/off\ errors,\ be\ consistent\ in\ ordering}}
\DoxyCodeLine{00568\ \textcolor{comment}{//\ For\ instance,\ to\ solve\ the\ secular\ equation\ using\ FMM,\ see\ http://www.stat.uchicago.edu/\string~lekheng/courses/302/classics/greengard-\/rokhlin.pdf}}
\DoxyCodeLine{00569\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00570\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::computeSVDofM(Index\ firstCol,\ Index\ n,\ MatrixXr\&\ U,\ VectorType\&\ singVals,\ MatrixXr\&\ V)}
\DoxyCodeLine{00571\ \{}
\DoxyCodeLine{00572\ \ \ \textcolor{keyword}{const}\ RealScalar\ considerZero\ =\ (std::numeric\_limits<RealScalar>::min)();}
\DoxyCodeLine{00573\ \ \ \textcolor{keyword}{using\ }std::abs;}
\DoxyCodeLine{00574\ \ \ ArrayRef\ col0\ =\ m\_computed.col(firstCol).segment(firstCol,\ n);}
\DoxyCodeLine{00575\ \ \ m\_workspace.head(n)\ =\ \ m\_computed.block(firstCol,\ firstCol,\ n,\ n).diagonal();}
\DoxyCodeLine{00576\ \ \ ArrayRef\ diag\ =\ m\_workspace.head(n);}
\DoxyCodeLine{00577\ \ \ diag(0)\ =\ 0;}
\DoxyCodeLine{00578\ }
\DoxyCodeLine{00579\ \ \ \textcolor{comment}{//\ Allocate\ space\ for\ singular\ values\ and\ vectors}}
\DoxyCodeLine{00580\ \ \ singVals.resize(n);}
\DoxyCodeLine{00581\ \ \ U.resize(n+1,\ n+1);}
\DoxyCodeLine{00582\ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ V.resize(n,\ n);}
\DoxyCodeLine{00583\ }
\DoxyCodeLine{00584\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00585\ \ \ \textcolor{keywordflow}{if}\ (col0.hasNaN()\ ||\ diag.hasNaN())}
\DoxyCodeLine{00586\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)nHAS\ NAN\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00587\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00588\ \ \ }
\DoxyCodeLine{00589\ \ \ \textcolor{comment}{//\ Many\ singular\ values\ might\ have\ been\ deflated,\ the\ zero\ ones\ have\ been\ moved\ to\ the\ end,}}
\DoxyCodeLine{00590\ \ \ \textcolor{comment}{//\ but\ others\ are\ interleaved\ and\ we\ must\ ignore\ them\ at\ this\ stage.}}
\DoxyCodeLine{00591\ \ \ \textcolor{comment}{//\ To\ this\ end,\ let's\ compute\ a\ permutation\ skipping\ them:}}
\DoxyCodeLine{00592\ \ \ Index\ actual\_n\ =\ n;}
\DoxyCodeLine{00593\ \ \ \textcolor{keywordflow}{while}(actual\_n>1\ \&\&\ diag(actual\_n-\/1)==0)\ -\/-\/actual\_n;}
\DoxyCodeLine{00594\ \ \ Index\ m\ =\ 0;\ \textcolor{comment}{//\ size\ of\ the\ deflated\ problem}}
\DoxyCodeLine{00595\ \ \ \textcolor{keywordflow}{for}(Index\ k=0;k<actual\_n;++k)}
\DoxyCodeLine{00596\ \ \ \ \ \textcolor{keywordflow}{if}(abs(col0(k))>considerZero)}
\DoxyCodeLine{00597\ \ \ \ \ \ \ m\_workspaceI(m++)\ =\ k;}
\DoxyCodeLine{00598\ \ \ Map<ArrayXi>\ perm(m\_workspaceI.data(),m);}
\DoxyCodeLine{00599\ \ \ }
\DoxyCodeLine{00600\ \ \ Map<ArrayXr>\ shifts(m\_workspace.data()+1*n,\ n);}
\DoxyCodeLine{00601\ \ \ Map<ArrayXr>\ mus(m\_workspace.data()+2*n,\ n);}
\DoxyCodeLine{00602\ \ \ Map<ArrayXr>\ zhat(m\_workspace.data()+3*n,\ n);}
\DoxyCodeLine{00603\ }
\DoxyCodeLine{00604\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00605\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}computeSVDofM\ using:\(\backslash\)n"{}};}
\DoxyCodeLine{00606\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ z:\ "{}}\ <<\ col0.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00607\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ d:\ "{}}\ <<\ diag.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00608\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00609\ \ \ }
\DoxyCodeLine{00610\ \ \ \textcolor{comment}{//\ Compute\ singVals,\ shifts,\ and\ mus}}
\DoxyCodeLine{00611\ \ \ computeSingVals(col0,\ diag,\ perm,\ singVals,\ shifts,\ mus);}
\DoxyCodeLine{00612\ \ \ }
\DoxyCodeLine{00613\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00614\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ j:\ \ \ \ \ \ \ \ "{}}\ <<\ (m\_computed.block(firstCol,\ firstCol,\ n,\ n)).jacobiSvd().singularValues().transpose().reverse()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00615\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ sing-\/val:\ "{}}\ <<\ singVals.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00616\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ mu:\ \ \ \ \ \ \ "{}}\ <<\ mus.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00617\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ shift:\ \ \ \ "{}}\ <<\ shifts.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00618\ \ \ }
\DoxyCodeLine{00619\ \ \ \{}
\DoxyCodeLine{00620\ \ \ \ \ Index\ actual\_n\ =\ n;}
\DoxyCodeLine{00621\ \ \ \ \ \textcolor{keywordflow}{while}(actual\_n>1\ \&\&\ abs(col0(actual\_n-\/1))<considerZero)\ -\/-\/actual\_n;}
\DoxyCodeLine{00622\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n\ \ \ \ mus:\ \ \ \ "{}}\ <<\ mus.head(actual\_n).transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00623\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ check1\ (expect0)\ :\ "{}}\ <<\ ((singVals.array()-\/(shifts+mus))\ /\ singVals.array()).head(actual\_n).transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00624\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ check2\ (>0)\ \ \ \ \ \ :\ "{}}\ <<\ ((singVals.array()-\/diag)\ /\ singVals.array()).head(actual\_n).transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00625\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ check3\ (>0)\ \ \ \ \ \ :\ "{}}\ <<\ ((diag.segment(1,actual\_n-\/1)-\/singVals.head(actual\_n-\/1).array())\ /\ singVals.head(actual\_n-\/1).array()).transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00626\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ check4\ (>0)\ \ \ \ \ \ :\ "{}}\ <<\ ((singVals.segment(1,actual\_n-\/1)-\/singVals.head(actual\_n-\/1))).transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00627\ \ \ \}}
\DoxyCodeLine{00628\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00629\ \ \ }
\DoxyCodeLine{00630\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00631\ \ \ assert(singVals.allFinite());}
\DoxyCodeLine{00632\ \ \ assert(mus.allFinite());}
\DoxyCodeLine{00633\ \ \ assert(shifts.allFinite());}
\DoxyCodeLine{00634\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00635\ \ \ }
\DoxyCodeLine{00636\ \ \ \textcolor{comment}{//\ Compute\ zhat}}
\DoxyCodeLine{00637\ \ \ perturbCol0(col0,\ diag,\ perm,\ singVals,\ shifts,\ mus,\ zhat);}
\DoxyCodeLine{00638\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00639\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ zhat:\ "{}}\ <<\ zhat.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00640\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00641\ \ \ }
\DoxyCodeLine{00642\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00643\ \ \ assert(zhat.allFinite());}
\DoxyCodeLine{00644\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00645\ \ \ }
\DoxyCodeLine{00646\ \ \ computeSingVecs(zhat,\ diag,\ perm,\ singVals,\ shifts,\ mus,\ U,\ V);}
\DoxyCodeLine{00647\ \ \ }
\DoxyCodeLine{00648\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00649\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}U\string^T\ U:\ "{}}\ <<\ (U.transpose()\ *\ U\ -\/\ MatrixXr(MatrixXr::Identity(U.cols(),U.cols()))).norm()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00650\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}V\string^T\ V:\ "{}}\ <<\ (V.transpose()\ *\ V\ -\/\ MatrixXr(MatrixXr::Identity(V.cols(),V.cols()))).norm()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00651\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00652\ \ \ }
\DoxyCodeLine{00653\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{00654\ \ \ assert(U.allFinite());}
\DoxyCodeLine{00655\ \ \ assert(V.allFinite());}
\DoxyCodeLine{00656\ \ \ assert((U.transpose()\ *\ U\ -\/\ MatrixXr(MatrixXr::Identity(U.cols(),U.cols()))).norm()\ <\ 1e-\/14\ *\ n);}
\DoxyCodeLine{00657\ \ \ assert((V.transpose()\ *\ V\ -\/\ MatrixXr(MatrixXr::Identity(V.cols(),V.cols()))).norm()\ <\ 1e-\/14\ *\ n);}
\DoxyCodeLine{00658\ \ \ assert(m\_naiveU.allFinite());}
\DoxyCodeLine{00659\ \ \ assert(m\_naiveV.allFinite());}
\DoxyCodeLine{00660\ \ \ assert(m\_computed.allFinite());}
\DoxyCodeLine{00661\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00662\ \ \ }
\DoxyCodeLine{00663\ \ \ \textcolor{comment}{//\ Because\ of\ deflation,\ the\ singular\ values\ might\ not\ be\ completely\ sorted.}}
\DoxyCodeLine{00664\ \ \ \textcolor{comment}{//\ Fortunately,\ reordering\ them\ is\ a\ O(n)\ problem}}
\DoxyCodeLine{00665\ \ \ \textcolor{keywordflow}{for}(Index\ i=0;\ i<actual\_n-\/1;\ ++i)}
\DoxyCodeLine{00666\ \ \ \{}
\DoxyCodeLine{00667\ \ \ \ \ \textcolor{keywordflow}{if}(singVals(i)>singVals(i+1))}
\DoxyCodeLine{00668\ \ \ \ \ \{}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \textcolor{keyword}{using\ }std::swap;}
\DoxyCodeLine{00670\ \ \ \ \ \ \ swap(singVals(i),singVals(i+1));}
\DoxyCodeLine{00671\ \ \ \ \ \ \ U.col(i).swap(U.col(i+1));}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(m\_compV)\ V.col(i).swap(V.col(i+1));}
\DoxyCodeLine{00673\ \ \ \ \ \}}
\DoxyCodeLine{00674\ \ \ \}}
\DoxyCodeLine{00675\ \ \ }
\DoxyCodeLine{00676\ \ \ \textcolor{comment}{//\ Reverse\ order\ so\ that\ singular\ values\ in\ increased\ order}}
\DoxyCodeLine{00677\ \ \ \textcolor{comment}{//\ Because\ of\ deflation,\ the\ zeros\ singular-\/values\ are\ already\ at\ the\ end}}
\DoxyCodeLine{00678\ \ \ singVals.head(actual\_n).reverseInPlace();}
\DoxyCodeLine{00679\ \ \ U.leftCols(actual\_n).rowwise().reverseInPlace();}
\DoxyCodeLine{00680\ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ V.leftCols(actual\_n).rowwise().reverseInPlace();}
\DoxyCodeLine{00681\ \ \ }
\DoxyCodeLine{00682\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00683\ \ \ JacobiSVD<MatrixXr>\ jsvd(m\_computed.block(firstCol,\ firstCol,\ n,\ n)\ );}
\DoxyCodeLine{00684\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ *\ j:\ \ \ \ \ \ \ \ "{}}\ <<\ jsvd.singularValues().transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00685\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ *\ sing-\/val:\ "{}}\ <<\ singVals.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00686\ \textcolor{comment}{//\ \ \ std::cout\ <<\ "{}\ \ *\ err:\ \ \ \ \ \ "{}\ <<\ ((jsvd.singularValues()-\/singVals)>1e-\/13*singVals.norm()).transpose()\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00687\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00688\ \}}
\DoxyCodeLine{00689\ }
\DoxyCodeLine{00690\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00691\ \textcolor{keyword}{typename}\ BDCSVD<MatrixType>::RealScalar\ BDCSVD<MatrixType>::secularEq(RealScalar\ mu,\ \textcolor{keyword}{const}\ ArrayRef\&\ col0,\ \textcolor{keyword}{const}\ ArrayRef\&\ diag,\ \textcolor{keyword}{const}\ IndicesRef\ \&perm,\ \textcolor{keyword}{const}\ ArrayRef\&\ diagShifted,\ RealScalar\ shift)}
\DoxyCodeLine{00692\ \{}
\DoxyCodeLine{00693\ \ \ Index\ m\ =\ perm.size();}
\DoxyCodeLine{00694\ \ \ RealScalar\ res\ =\ 1;}
\DoxyCodeLine{00695\ \ \ \textcolor{keywordflow}{for}(Index\ i=0;\ i<m;\ ++i)}
\DoxyCodeLine{00696\ \ \ \{}
\DoxyCodeLine{00697\ \ \ \ \ Index\ j\ =\ perm(i);}
\DoxyCodeLine{00698\ \ \ \ \ res\ +=\ numext::abs2(col0(j))\ /\ ((diagShifted(j)\ -\/\ mu)\ *\ (diag(j)\ +\ shift\ +\ mu));}
\DoxyCodeLine{00699\ \ \ \}}
\DoxyCodeLine{00700\ \ \ \textcolor{keywordflow}{return}\ res;}
\DoxyCodeLine{00701\ }
\DoxyCodeLine{00702\ \}}
\DoxyCodeLine{00703\ }
\DoxyCodeLine{00704\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00705\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::computeSingVals(\textcolor{keyword}{const}\ ArrayRef\&\ col0,\ \textcolor{keyword}{const}\ ArrayRef\&\ diag,\ \textcolor{keyword}{const}\ IndicesRef\ \&perm,}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ VectorType\&\ singVals,\ ArrayRef\ shifts,\ ArrayRef\ mus)}
\DoxyCodeLine{00707\ \{}
\DoxyCodeLine{00708\ \ \ \textcolor{keyword}{using\ }std::abs;}
\DoxyCodeLine{00709\ \ \ \textcolor{keyword}{using\ }std::swap;}
\DoxyCodeLine{00710\ }
\DoxyCodeLine{00711\ \ \ Index\ n\ =\ col0.size();}
\DoxyCodeLine{00712\ \ \ Index\ actual\_n\ =\ n;}
\DoxyCodeLine{00713\ \ \ \textcolor{keywordflow}{while}(actual\_n>1\ \&\&\ col0(actual\_n-\/1)==0)\ -\/-\/actual\_n;}
\DoxyCodeLine{00714\ }
\DoxyCodeLine{00715\ \ \ \textcolor{keywordflow}{for}\ (Index\ k\ =\ 0;\ k\ <\ n;\ ++k)}
\DoxyCodeLine{00716\ \ \ \{}
\DoxyCodeLine{00717\ \ \ \ \ \textcolor{keywordflow}{if}\ (col0(k)\ ==\ 0\ ||\ actual\_n==1)}
\DoxyCodeLine{00718\ \ \ \ \ \{}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \textcolor{comment}{//\ if\ col0(k)\ ==\ 0,\ then\ entry\ is\ deflated,\ so\ singular\ value\ is\ on\ diagonal}}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \textcolor{comment}{//\ if\ actual\_n==1,\ then\ the\ deflated\ problem\ is\ already\ diagonalized}}
\DoxyCodeLine{00721\ \ \ \ \ \ \ singVals(k)\ =\ k==0\ ?\ col0(0)\ :\ diag(k);}
\DoxyCodeLine{00722\ \ \ \ \ \ \ mus(k)\ =\ 0;}
\DoxyCodeLine{00723\ \ \ \ \ \ \ shifts(k)\ =\ k==0\ ?\ col0(0)\ :\ diag(k);}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00725\ \ \ \ \ \}\ }
\DoxyCodeLine{00726\ }
\DoxyCodeLine{00727\ \ \ \ \ \textcolor{comment}{//\ otherwise,\ use\ secular\ equation\ to\ find\ singular\ value}}
\DoxyCodeLine{00728\ \ \ \ \ RealScalar\ left\ =\ diag(k);}
\DoxyCodeLine{00729\ \ \ \ \ RealScalar\ right;\ \textcolor{comment}{//\ was:\ =\ (k\ !=\ actual\_n-\/1)\ ?\ diag(k+1)\ :\ (diag(actual\_n-\/1)\ +\ col0.matrix().norm());}}
\DoxyCodeLine{00730\ \ \ \ \ \textcolor{keywordflow}{if}(k==actual\_n-\/1)}
\DoxyCodeLine{00731\ \ \ \ \ \ \ right\ =\ (diag(actual\_n-\/1)\ +\ col0.matrix().norm());}
\DoxyCodeLine{00732\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00733\ \ \ \ \ \{}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ deflated\ singular\ values}}
\DoxyCodeLine{00735\ \ \ \ \ \ \ Index\ l\ =\ k+1;}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \textcolor{keywordflow}{while}(col0(l)==0)\ \{\ ++l;\ eigen\_internal\_assert(l<actual\_n);\ \}}
\DoxyCodeLine{00737\ \ \ \ \ \ \ right\ =\ diag(l);}
\DoxyCodeLine{00738\ \ \ \ \ \}}
\DoxyCodeLine{00739\ }
\DoxyCodeLine{00740\ \ \ \ \ \textcolor{comment}{//\ first\ decide\ whether\ it's\ closer\ to\ the\ left\ end\ or\ the\ right\ end}}
\DoxyCodeLine{00741\ \ \ \ \ RealScalar\ mid\ =\ left\ +\ (right-\/left)\ /\ 2;}
\DoxyCodeLine{00742\ \ \ \ \ RealScalar\ fMid\ =\ secularEq(mid,\ col0,\ diag,\ perm,\ diag,\ 0);}
\DoxyCodeLine{00743\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00744\ \ \ \ \ std::cout\ <<\ right-\/left\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00745\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}fMid\ =\ "{}}\ <<\ fMid\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ secularEq(mid-\/left,\ col0,\ diag,\ perm,\ diag-\/left,\ left)\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ secularEq(mid-\/right,\ col0,\ diag,\ perm,\ diag-\/right,\ right)\ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00746\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ \ =\ "{}}\ <<\ secularEq(0.1*(left+right),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(0.2*(left+right),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(0.3*(left+right),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00749\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(0.4*(left+right),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(0.49*(left+right),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00751\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(0.5*(left+right),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(0.51*(left+right),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(0.6*(left+right),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(0.7*(left+right),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(0.8*(left+right),\ col0,\ diag,\ perm,\ diag,\ 0)}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ \ \ \ \ \ \ <<\ secularEq(0.9*(left+right),\ col0,\ diag,\ perm,\ diag,\ 0)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00757\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00758\ \ \ \ \ RealScalar\ shift\ =\ (k\ ==\ actual\_n-\/1\ ||\ fMid\ >\ 0)\ ?\ left\ :\ right;}
\DoxyCodeLine{00759\ \ \ \ \ }
\DoxyCodeLine{00760\ \ \ \ \ \textcolor{comment}{//\ measure\ everything\ relative\ to\ shift}}
\DoxyCodeLine{00761\ \ \ \ \ Map<ArrayXr>\ diagShifted(m\_workspace.data()+4*n,\ n);}
\DoxyCodeLine{00762\ \ \ \ \ diagShifted\ =\ diag\ -\/\ shift;}
\DoxyCodeLine{00763\ \ \ \ \ }
\DoxyCodeLine{00764\ \ \ \ \ \textcolor{comment}{//\ initial\ guess}}
\DoxyCodeLine{00765\ \ \ \ \ RealScalar\ muPrev,\ muCur;}
\DoxyCodeLine{00766\ \ \ \ \ \textcolor{keywordflow}{if}\ (shift\ ==\ left)}
\DoxyCodeLine{00767\ \ \ \ \ \{}
\DoxyCodeLine{00768\ \ \ \ \ \ \ muPrev\ =\ (right\ -\/\ left)\ *\ RealScalar(0.1);}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (k\ ==\ actual\_n-\/1)\ muCur\ =\ right\ -\/\ left;}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ muCur\ =\ (right\ -\/\ left)\ *\ RealScalar(0.5);}
\DoxyCodeLine{00771\ \ \ \ \ \}}
\DoxyCodeLine{00772\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00773\ \ \ \ \ \{}
\DoxyCodeLine{00774\ \ \ \ \ \ \ muPrev\ =\ -\/(right\ -\/\ left)\ *\ RealScalar(0.1);}
\DoxyCodeLine{00775\ \ \ \ \ \ \ muCur\ =\ -\/(right\ -\/\ left)\ *\ RealScalar(0.5);}
\DoxyCodeLine{00776\ \ \ \ \ \}}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00778\ \ \ \ \ RealScalar\ fPrev\ =\ secularEq(muPrev,\ col0,\ diag,\ perm,\ diagShifted,\ shift);}
\DoxyCodeLine{00779\ \ \ \ \ RealScalar\ fCur\ =\ secularEq(muCur,\ col0,\ diag,\ perm,\ diagShifted,\ shift);}
\DoxyCodeLine{00780\ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(fPrev)\ <\ abs(fCur))}
\DoxyCodeLine{00781\ \ \ \ \ \{}
\DoxyCodeLine{00782\ \ \ \ \ \ \ swap(fPrev,\ fCur);}
\DoxyCodeLine{00783\ \ \ \ \ \ \ swap(muPrev,\ muCur);}
\DoxyCodeLine{00784\ \ \ \ \ \}}
\DoxyCodeLine{00785\ }
\DoxyCodeLine{00786\ \ \ \ \ \textcolor{comment}{//\ rational\ interpolation:\ fit\ a\ function\ of\ the\ form\ a\ /\ mu\ +\ b\ through\ the\ two\ previous}}
\DoxyCodeLine{00787\ \ \ \ \ \textcolor{comment}{//\ iterates\ and\ use\ its\ zero\ to\ compute\ the\ next\ iterate}}
\DoxyCodeLine{00788\ \ \ \ \ \textcolor{keywordtype}{bool}\ useBisection\ =\ fPrev*fCur>0;}
\DoxyCodeLine{00789\ \ \ \ \ \textcolor{keywordflow}{while}\ (fCur!=0\ \&\&\ abs(muCur\ -\/\ muPrev)\ >\ 8\ *\ NumTraits<RealScalar>::epsilon()\ *\ numext::maxi<RealScalar>(abs(muCur),\ abs(muPrev))\ \&\&\ abs(fCur\ -\/\ fPrev)>NumTraits<RealScalar>::epsilon()\ \&\&\ !useBisection)}
\DoxyCodeLine{00790\ \ \ \ \ \{}
\DoxyCodeLine{00791\ \ \ \ \ \ \ ++m\_numIters;}
\DoxyCodeLine{00792\ }
\DoxyCodeLine{00793\ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ a\ and\ b\ such\ that\ the\ function\ f(mu)\ =\ a\ /\ mu\ +\ b\ matches\ the\ current\ and\ previous\ samples.}}
\DoxyCodeLine{00794\ \ \ \ \ \ \ RealScalar\ a\ =\ (fCur\ -\/\ fPrev)\ /\ (1/muCur\ -\/\ 1/muPrev);}
\DoxyCodeLine{00795\ \ \ \ \ \ \ RealScalar\ b\ =\ fCur\ -\/\ a\ /\ muCur;}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \textcolor{comment}{//\ And\ find\ mu\ such\ that\ f(mu)==0:}}
\DoxyCodeLine{00797\ \ \ \ \ \ \ RealScalar\ muZero\ =\ -\/a/b;}
\DoxyCodeLine{00798\ \ \ \ \ \ \ RealScalar\ fZero\ =\ secularEq(muZero,\ col0,\ diag,\ perm,\ diagShifted,\ shift);}
\DoxyCodeLine{00799\ \ \ \ \ \ \ }
\DoxyCodeLine{00800\ \ \ \ \ \ \ muPrev\ =\ muCur;}
\DoxyCodeLine{00801\ \ \ \ \ \ \ fPrev\ =\ fCur;}
\DoxyCodeLine{00802\ \ \ \ \ \ \ muCur\ =\ muZero;}
\DoxyCodeLine{00803\ \ \ \ \ \ \ fCur\ =\ fZero;}
\DoxyCodeLine{00804\ \ \ \ \ \ \ }
\DoxyCodeLine{00805\ \ \ \ \ \ \ }
\DoxyCodeLine{00806\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (shift\ ==\ left\ \ \&\&\ (muCur\ <\ 0\ ||\ muCur\ >\ right\ -\/\ left))\ useBisection\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (shift\ ==\ right\ \&\&\ (muCur\ <\ -\/(right\ -\/\ left)\ ||\ muCur\ >\ 0))\ useBisection\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(fCur)>abs(fPrev))\ useBisection\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00809\ \ \ \ \ \}}
\DoxyCodeLine{00810\ }
\DoxyCodeLine{00811\ \ \ \ \ \textcolor{comment}{//\ fall\ back\ on\ bisection\ method\ if\ rational\ interpolation\ did\ not\ work}}
\DoxyCodeLine{00812\ \ \ \ \ \textcolor{keywordflow}{if}\ (useBisection)}
\DoxyCodeLine{00813\ \ \ \ \ \{}
\DoxyCodeLine{00814\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00815\ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}useBisection\ for\ k\ =\ "{}}\ <<\ k\ <<\ \textcolor{stringliteral}{"{},\ actual\_n\ =\ "{}}\ <<\ actual\_n\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00816\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00817\ \ \ \ \ \ \ RealScalar\ leftShifted,\ rightShifted;}
\DoxyCodeLine{00818\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (shift\ ==\ left)}
\DoxyCodeLine{00819\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ leftShifted\ =\ (std::numeric\_limits<RealScalar>::min)();}
\DoxyCodeLine{00821\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ I\ don't\ understand\ why\ the\ case\ k==0\ would\ be\ special\ there:}}
\DoxyCodeLine{00822\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (k\ ==\ 0)\ rightShifted\ =\ right\ -\/\ left;\ else\ }}
\DoxyCodeLine{00823\ \ \ \ \ \ \ \ \ rightShifted\ =\ (k==actual\_n-\/1)\ ?\ right\ :\ ((right\ -\/\ left)\ *\ RealScalar(0.6));\ \textcolor{comment}{//\ theoretically\ we\ can\ take\ 0.5,\ but\ let's\ be\ safe}}
\DoxyCodeLine{00824\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00825\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ leftShifted\ =\ -\/(right\ -\/\ left)\ *\ RealScalar(0.6);}
\DoxyCodeLine{00828\ \ \ \ \ \ \ \ \ rightShifted\ =\ -\/(std::numeric\_limits<RealScalar>::min)();}
\DoxyCodeLine{00829\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00830\ \ \ \ \ \ \ }
\DoxyCodeLine{00831\ \ \ \ \ \ \ RealScalar\ fLeft\ =\ secularEq(leftShifted,\ col0,\ diag,\ perm,\ diagShifted,\ shift);}
\DoxyCodeLine{00832\ }
\DoxyCodeLine{00833\ \textcolor{preprocessor}{\#if\ defined\ EIGEN\_INTERNAL\_DEBUGGING\ ||\ defined\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00834\ \ \ \ \ \ \ RealScalar\ fRight\ =\ secularEq(rightShifted,\ col0,\ diag,\ perm,\ diagShifted,\ shift);}
\DoxyCodeLine{00835\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00836\ }
\DoxyCodeLine{00837\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!(fLeft\ *\ fRight<0))}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}fLeft:\ "{}}\ <<\ leftShifted\ <<\ \textcolor{stringliteral}{"{}\ -\/\ "{}}\ <<\ diagShifted.head(10).transpose()\ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\ ;\ "{}}\ <<\ bool(left==shift)\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ (left-\/shift)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00841\ \ \ \ \ \ \ \ \ std::cout\ <<\ k\ <<\ \textcolor{stringliteral}{"{}\ :\ "{}}\ <<\ \ fLeft\ <<\ \textcolor{stringliteral}{"{}\ *\ "{}}\ <<\ fRight\ <<\ \textcolor{stringliteral}{"{}\ ==\ "{}}\ <<\ fLeft\ *\ fRight\ <<\ \textcolor{stringliteral}{"{}\ \ ;\ \ "{}}\ <<\ left\ <<\ \textcolor{stringliteral}{"{}\ -\/\ "{}}\ <<\ right\ <<\ \textcolor{stringliteral}{"{}\ -\/>\ "{}}\ <<\ \ leftShifted\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ rightShifted\ <<\ \textcolor{stringliteral}{"{}\ \ \ shift="{}}\ <<\ shift\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00842\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00843\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00844\ \ \ \ \ \ \ eigen\_internal\_assert(fLeft\ *\ fRight\ <\ 0);}
\DoxyCodeLine{00845\ \ \ \ \ \ \ }
\DoxyCodeLine{00846\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (rightShifted\ -\/\ leftShifted\ >\ 2\ *\ NumTraits<RealScalar>::epsilon()\ *\ numext::maxi<RealScalar>(abs(leftShifted),\ abs(rightShifted)))}
\DoxyCodeLine{00847\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \ \ RealScalar\ midShifted\ =\ (leftShifted\ +\ rightShifted)\ /\ 2;}
\DoxyCodeLine{00849\ \ \ \ \ \ \ \ \ fMid\ =\ secularEq(midShifted,\ col0,\ diag,\ perm,\ diagShifted,\ shift);}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fLeft\ *\ fMid\ <\ 0)}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ \ \ rightShifted\ =\ midShifted;}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00854\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00855\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00856\ \ \ \ \ \ \ \ \ \ \ leftShifted\ =\ midShifted;}
\DoxyCodeLine{00857\ \ \ \ \ \ \ \ \ \ \ fLeft\ =\ fMid;}
\DoxyCodeLine{00858\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00859\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00860\ }
\DoxyCodeLine{00861\ \ \ \ \ \ \ muCur\ =\ (leftShifted\ +\ rightShifted)\ /\ 2;}
\DoxyCodeLine{00862\ \ \ \ \ \}}
\DoxyCodeLine{00863\ \ \ \ \ \ \ }
\DoxyCodeLine{00864\ \ \ \ \ singVals[k]\ =\ shift\ +\ muCur;}
\DoxyCodeLine{00865\ \ \ \ \ shifts[k]\ =\ shift;}
\DoxyCodeLine{00866\ \ \ \ \ mus[k]\ =\ muCur;}
\DoxyCodeLine{00867\ }
\DoxyCodeLine{00868\ \ \ \ \ \textcolor{comment}{//\ perturb\ singular\ value\ slightly\ if\ it\ equals\ diagonal\ entry\ to\ avoid\ division\ by\ zero\ later}}
\DoxyCodeLine{00869\ \ \ \ \ \textcolor{comment}{//\ (deflation\ is\ supposed\ to\ avoid\ this\ from\ happening)}}
\DoxyCodeLine{00870\ \ \ \ \ \textcolor{comment}{//\ -\/\ this\ does\ no\ seem\ to\ be\ necessary\ anymore\ -\/}}
\DoxyCodeLine{00871\ \textcolor{comment}{//\ \ \ \ \ if\ (singVals[k]\ ==\ left)\ singVals[k]\ *=\ 1\ +\ NumTraits<RealScalar>::epsilon();}}
\DoxyCodeLine{00872\ \textcolor{comment}{//\ \ \ \ \ if\ (singVals[k]\ ==\ right)\ singVals[k]\ *=\ 1\ -\/\ NumTraits<RealScalar>::epsilon();}}
\DoxyCodeLine{00873\ \ \ \}}
\DoxyCodeLine{00874\ \}}
\DoxyCodeLine{00875\ }
\DoxyCodeLine{00876\ }
\DoxyCodeLine{00877\ \textcolor{comment}{//\ zhat\ is\ perturbation\ of\ col0\ for\ which\ singular\ vectors\ can\ be\ computed\ stably\ (see\ Section\ 3.1)}}
\DoxyCodeLine{00878\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00879\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::perturbCol0}
\DoxyCodeLine{00880\ \ \ \ (\textcolor{keyword}{const}\ ArrayRef\&\ col0,\ \textcolor{keyword}{const}\ ArrayRef\&\ diag,\ \textcolor{keyword}{const}\ IndicesRef\ \&perm,\ \textcolor{keyword}{const}\ VectorType\&\ singVals,}
\DoxyCodeLine{00881\ \ \ \ \ \textcolor{keyword}{const}\ ArrayRef\&\ shifts,\ \textcolor{keyword}{const}\ ArrayRef\&\ mus,\ ArrayRef\ zhat)}
\DoxyCodeLine{00882\ \{}
\DoxyCodeLine{00883\ \ \ \textcolor{keyword}{using\ }std::sqrt;}
\DoxyCodeLine{00884\ \ \ Index\ n\ =\ col0.size();}
\DoxyCodeLine{00885\ \ \ Index\ m\ =\ perm.size();}
\DoxyCodeLine{00886\ \ \ \textcolor{keywordflow}{if}(m==0)}
\DoxyCodeLine{00887\ \ \ \{}
\DoxyCodeLine{00888\ \ \ \ \ zhat.setZero();}
\DoxyCodeLine{00889\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00890\ \ \ \}}
\DoxyCodeLine{00891\ \ \ Index\ last\ =\ perm(m-\/1);}
\DoxyCodeLine{00892\ \ \ \textcolor{comment}{//\ The\ offset\ permits\ to\ skip\ deflated\ entries\ while\ computing\ zhat}}
\DoxyCodeLine{00893\ \ \ \textcolor{keywordflow}{for}\ (Index\ k\ =\ 0;\ k\ <\ n;\ ++k)}
\DoxyCodeLine{00894\ \ \ \{}
\DoxyCodeLine{00895\ \ \ \ \ \textcolor{keywordflow}{if}\ (col0(k)\ ==\ 0)\ \textcolor{comment}{//\ deflated}}
\DoxyCodeLine{00896\ \ \ \ \ \ \ zhat(k)\ =\ 0;}
\DoxyCodeLine{00897\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00898\ \ \ \ \ \{}
\DoxyCodeLine{00899\ \ \ \ \ \ \ \textcolor{comment}{//\ see\ equation\ (3.6)}}
\DoxyCodeLine{00900\ \ \ \ \ \ \ RealScalar\ dk\ =\ diag(k);}
\DoxyCodeLine{00901\ \ \ \ \ \ \ RealScalar\ prod\ =\ (singVals(last)\ +\ dk)\ *\ (mus(last)\ +\ (shifts(last)\ -\/\ dk));}
\DoxyCodeLine{00902\ }
\DoxyCodeLine{00903\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(Index\ l\ =\ 0;\ l<m;\ ++l)}
\DoxyCodeLine{00904\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00905\ \ \ \ \ \ \ \ \ Index\ i\ =\ perm(l);}
\DoxyCodeLine{00906\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i!=k)}
\DoxyCodeLine{00907\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00908\ \ \ \ \ \ \ \ \ \ \ Index\ j\ =\ i<k\ ?\ i\ :\ perm(l-\/1);}
\DoxyCodeLine{00909\ \ \ \ \ \ \ \ \ \ \ prod\ *=\ ((singVals(j)+dk)\ /\ ((diag(i)+dk)))\ *\ ((mus(j)+(shifts(j)-\/dk))\ /\ ((diag(i)-\/dk)));}
\DoxyCodeLine{00910\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00911\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i!=k\ \&\&\ std::abs(((singVals(j)+dk)*(mus(j)+(shifts(j)-\/dk)))/((diag(i)+dk)*(diag(i)-\/dk))\ -\/\ 1)\ >\ 0.9\ )}
\DoxyCodeLine{00912\ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ \ "{}}\ <<\ ((singVals(j)+dk)*(mus(j)+(shifts(j)-\/dk)))/((diag(i)+dk)*(diag(i)-\/dk))\ <<\ \textcolor{stringliteral}{"{}\ ==\ ("{}}\ <<\ (singVals(j)+dk)\ <<\ \textcolor{stringliteral}{"{}\ *\ "{}}\ <<\ (mus(j)+(shifts(j)-\/dk))}
\DoxyCodeLine{00913\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{})\ /\ ("{}}\ <<\ (diag(i)+dk)\ <<\ \textcolor{stringliteral}{"{}\ *\ "{}}\ <<\ (diag(i)-\/dk)\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}};}
\DoxyCodeLine{00914\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00915\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00916\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00917\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{00918\ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}zhat("{}}\ <<\ k\ <<\ \textcolor{stringliteral}{"{})\ =\ \ sqrt(\ "{}}\ <<\ prod\ <<\ \textcolor{stringliteral}{"{})\ \ ;\ \ "{}}\ <<\ (singVals(last)\ +\ dk)\ <<\ \textcolor{stringliteral}{"{}\ *\ "{}}\ <<\ mus(last)\ +\ shifts(last)\ <<\ \textcolor{stringliteral}{"{}\ -\/\ "{}}\ <<\ dk\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00919\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00920\ \ \ \ \ \ \ RealScalar\ tmp\ =\ sqrt(prod);}
\DoxyCodeLine{00921\ \ \ \ \ \ \ zhat(k)\ =\ col0(k)\ >\ 0\ ?\ tmp\ :\ -\/tmp;}
\DoxyCodeLine{00922\ \ \ \ \ \}}
\DoxyCodeLine{00923\ \ \ \}}
\DoxyCodeLine{00924\ \}}
\DoxyCodeLine{00925\ }
\DoxyCodeLine{00926\ \textcolor{comment}{//\ compute\ singular\ vectors}}
\DoxyCodeLine{00927\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00928\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::computeSingVecs}
\DoxyCodeLine{00929\ \ \ \ (\textcolor{keyword}{const}\ ArrayRef\&\ zhat,\ \textcolor{keyword}{const}\ ArrayRef\&\ diag,\ \textcolor{keyword}{const}\ IndicesRef\ \&perm,\ \textcolor{keyword}{const}\ VectorType\&\ singVals,}
\DoxyCodeLine{00930\ \ \ \ \ \textcolor{keyword}{const}\ ArrayRef\&\ shifts,\ \textcolor{keyword}{const}\ ArrayRef\&\ mus,\ MatrixXr\&\ U,\ MatrixXr\&\ V)}
\DoxyCodeLine{00931\ \{}
\DoxyCodeLine{00932\ \ \ Index\ n\ =\ zhat.size();}
\DoxyCodeLine{00933\ \ \ Index\ m\ =\ perm.size();}
\DoxyCodeLine{00934\ \ \ }
\DoxyCodeLine{00935\ \ \ \textcolor{keywordflow}{for}\ (Index\ k\ =\ 0;\ k\ <\ n;\ ++k)}
\DoxyCodeLine{00936\ \ \ \{}
\DoxyCodeLine{00937\ \ \ \ \ \textcolor{keywordflow}{if}\ (zhat(k)\ ==\ 0)}
\DoxyCodeLine{00938\ \ \ \ \ \{}
\DoxyCodeLine{00939\ \ \ \ \ \ \ U.col(k)\ =\ VectorType::Unit(n+1,\ k);}
\DoxyCodeLine{00940\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ V.col(k)\ =\ VectorType::Unit(n,\ k);}
\DoxyCodeLine{00941\ \ \ \ \ \}}
\DoxyCodeLine{00942\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00943\ \ \ \ \ \{}
\DoxyCodeLine{00944\ \ \ \ \ \ \ U.col(k).setZero();}
\DoxyCodeLine{00945\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(Index\ l=0;l<m;++l)}
\DoxyCodeLine{00946\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00947\ \ \ \ \ \ \ \ \ Index\ i\ =\ perm(l);}
\DoxyCodeLine{00948\ \ \ \ \ \ \ \ \ U(i,k)\ =\ zhat(i)/(((diag(i)\ -\/\ shifts(k))\ -\/\ mus(k))\ )/(\ (diag(i)\ +\ singVals[k]));}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00950\ \ \ \ \ \ \ U(n,k)\ =\ 0;\ \ \ \ \ \ }
\DoxyCodeLine{00951\ \ \ \ \ \ \ U.col(k).normalize();}
\DoxyCodeLine{00952\ \ \ \ \ }
\DoxyCodeLine{00953\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_compV)}
\DoxyCodeLine{00954\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00955\ \ \ \ \ \ \ \ \ V.col(k).setZero();}
\DoxyCodeLine{00956\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(Index\ l=1;l<m;++l)}
\DoxyCodeLine{00957\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00958\ \ \ \ \ \ \ \ \ \ \ Index\ i\ =\ perm(l);}
\DoxyCodeLine{00959\ \ \ \ \ \ \ \ \ \ \ V(i,k)\ =\ diag(i)\ *\ zhat(i)\ /\ (((diag(i)\ -\/\ shifts(k))\ -\/\ mus(k))\ )/(\ (diag(i)\ +\ singVals[k]));}
\DoxyCodeLine{00960\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00961\ \ \ \ \ \ \ \ \ V(0,k)\ =\ -\/1;}
\DoxyCodeLine{00962\ \ \ \ \ \ \ \ \ V.col(k).normalize();}
\DoxyCodeLine{00963\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00964\ \ \ \ \ \}}
\DoxyCodeLine{00965\ \ \ \}}
\DoxyCodeLine{00966\ \ \ U.col(n)\ =\ VectorType::Unit(n+1,\ n);}
\DoxyCodeLine{00967\ \}}
\DoxyCodeLine{00968\ }
\DoxyCodeLine{00969\ }
\DoxyCodeLine{00970\ \textcolor{comment}{//\ page\ 12\_13}}
\DoxyCodeLine{00971\ \textcolor{comment}{//\ i\ >=\ 1,\ di\ almost\ null\ and\ zi\ non\ null.}}
\DoxyCodeLine{00972\ \textcolor{comment}{//\ We\ use\ a\ rotation\ to\ zero\ out\ zi\ applied\ to\ the\ left\ of\ M}}
\DoxyCodeLine{00973\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00974\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::deflation43(Index\ firstCol,\ Index\ shift,\ Index\ i,\ Index\ size)}
\DoxyCodeLine{00975\ \{}
\DoxyCodeLine{00976\ \ \ \textcolor{keyword}{using\ }std::abs;}
\DoxyCodeLine{00977\ \ \ \textcolor{keyword}{using\ }std::sqrt;}
\DoxyCodeLine{00978\ \ \ \textcolor{keyword}{using\ }std::pow;}
\DoxyCodeLine{00979\ \ \ Index\ start\ =\ firstCol\ +\ shift;}
\DoxyCodeLine{00980\ \ \ RealScalar\ c\ =\ m\_computed(start,\ start);}
\DoxyCodeLine{00981\ \ \ RealScalar\ s\ =\ m\_computed(start+i,\ start);}
\DoxyCodeLine{00982\ \ \ RealScalar\ r\ =\ sqrt(numext::abs2(c)\ +\ numext::abs2(s));}
\DoxyCodeLine{00983\ \ \ \textcolor{keywordflow}{if}\ (r\ ==\ 0)}
\DoxyCodeLine{00984\ \ \ \{}
\DoxyCodeLine{00985\ \ \ \ \ m\_computed(start+i,\ start+i)\ =\ 0;}
\DoxyCodeLine{00986\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00987\ \ \ \}}
\DoxyCodeLine{00988\ \ \ m\_computed(start,start)\ =\ r;\ \ }
\DoxyCodeLine{00989\ \ \ m\_computed(start+i,\ start)\ =\ 0;}
\DoxyCodeLine{00990\ \ \ m\_computed(start+i,\ start+i)\ =\ 0;}
\DoxyCodeLine{00991\ \ \ }
\DoxyCodeLine{00992\ \ \ JacobiRotation<RealScalar>\ J(c/r,-\/s/r);}
\DoxyCodeLine{00993\ \ \ \textcolor{keywordflow}{if}\ (m\_compU)\ \ m\_naiveU.middleRows(firstCol,\ size+1).applyOnTheRight(firstCol,\ firstCol+i,\ J);}
\DoxyCodeLine{00994\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ m\_naiveU.applyOnTheRight(firstCol,\ firstCol+i,\ J);}
\DoxyCodeLine{00995\ \}\textcolor{comment}{//\ end\ deflation\ 43}}
\DoxyCodeLine{00996\ }
\DoxyCodeLine{00997\ }
\DoxyCodeLine{00998\ \textcolor{comment}{//\ page\ 13}}
\DoxyCodeLine{00999\ \textcolor{comment}{//\ i,j\ >=\ 1,\ i!=j\ and\ |di\ -\/\ dj|\ <\ epsilon\ *\ norm2(M)}}
\DoxyCodeLine{01000\ \textcolor{comment}{//\ We\ apply\ two\ rotations\ to\ have\ zj\ =\ 0;}}
\DoxyCodeLine{01001\ \textcolor{comment}{//\ TODO\ deflation44\ is\ still\ broken\ and\ not\ properly\ tested}}
\DoxyCodeLine{01002\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{01003\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::deflation44(Index\ firstColu\ ,\ Index\ firstColm,\ Index\ firstRowW,\ Index\ firstColW,\ Index\ i,\ Index\ j,\ Index\ size)}
\DoxyCodeLine{01004\ \{}
\DoxyCodeLine{01005\ \ \ \textcolor{keyword}{using\ }std::abs;}
\DoxyCodeLine{01006\ \ \ \textcolor{keyword}{using\ }std::sqrt;}
\DoxyCodeLine{01007\ \ \ \textcolor{keyword}{using\ }std::conj;}
\DoxyCodeLine{01008\ \ \ \textcolor{keyword}{using\ }std::pow;}
\DoxyCodeLine{01009\ \ \ RealScalar\ c\ =\ m\_computed(firstColm+i,\ firstColm);}
\DoxyCodeLine{01010\ \ \ RealScalar\ s\ =\ m\_computed(firstColm+j,\ firstColm);}
\DoxyCodeLine{01011\ \ \ RealScalar\ r\ =\ sqrt(numext::abs2(c)\ +\ numext::abs2(s));}
\DoxyCodeLine{01012\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01013\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}deflation\ 4.4:\ "{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{},"{}}\ <<\ j\ <<\ \textcolor{stringliteral}{"{}\ -\/>\ "{}}\ <<\ c\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ s\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ r\ <<\ \textcolor{stringliteral}{"{}\ ;\ "{}}}
\DoxyCodeLine{01014\ \ \ \ \ <<\ m\_computed(firstColm\ +\ i-\/1,\ firstColm)\ \ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{01015\ \ \ \ \ <<\ m\_computed(firstColm\ +\ i,\ firstColm)\ \ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{01016\ \ \ \ \ <<\ m\_computed(firstColm\ +\ i+1,\ firstColm)\ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{01017\ \ \ \ \ <<\ m\_computed(firstColm\ +\ i+2,\ firstColm)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01018\ \ \ std::cout\ <<\ m\_computed(firstColm\ +\ i-\/1,\ firstColm\ +\ i-\/1)\ \ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{01019\ \ \ \ \ <<\ m\_computed(firstColm\ +\ i,\ firstColm+i)\ \ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{01020\ \ \ \ \ <<\ m\_computed(firstColm\ +\ i+1,\ firstColm+i+1)\ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{01021\ \ \ \ \ <<\ m\_computed(firstColm\ +\ i+2,\ firstColm+i+2)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01022\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01023\ \ \ \textcolor{keywordflow}{if}\ (r==0)}
\DoxyCodeLine{01024\ \ \ \{}
\DoxyCodeLine{01025\ \ \ \ \ m\_computed(firstColm\ +\ i,\ firstColm\ +\ i)\ =\ m\_computed(firstColm\ +\ j,\ firstColm\ +\ j);}
\DoxyCodeLine{01026\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01027\ \ \ \}}
\DoxyCodeLine{01028\ \ \ c/=r;}
\DoxyCodeLine{01029\ \ \ s/=r;}
\DoxyCodeLine{01030\ \ \ m\_computed(firstColm\ +\ i,\ firstColm)\ =\ r;\ \ }
\DoxyCodeLine{01031\ \ \ m\_computed(firstColm\ +\ j,\ firstColm\ +\ j)\ =\ m\_computed(firstColm\ +\ i,\ firstColm\ +\ i);}
\DoxyCodeLine{01032\ \ \ m\_computed(firstColm\ +\ j,\ firstColm)\ =\ 0;}
\DoxyCodeLine{01033\ }
\DoxyCodeLine{01034\ \ \ JacobiRotation<RealScalar>\ J(c,-\/s);}
\DoxyCodeLine{01035\ \ \ \textcolor{keywordflow}{if}\ (m\_compU)\ \ m\_naiveU.middleRows(firstColu,\ size+1).applyOnTheRight(firstColu\ +\ i,\ firstColu\ +\ j,\ J);}
\DoxyCodeLine{01036\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ m\_naiveU.applyOnTheRight(firstColu+i,\ firstColu+j,\ J);}
\DoxyCodeLine{01037\ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ \ m\_naiveV.middleRows(firstRowW,\ size).applyOnTheRight(firstColW\ +\ i,\ firstColW\ +\ j,\ J);}
\DoxyCodeLine{01038\ \}\textcolor{comment}{//\ end\ deflation\ 44}}
\DoxyCodeLine{01039\ }
\DoxyCodeLine{01040\ }
\DoxyCodeLine{01041\ \textcolor{comment}{//\ acts\ on\ block\ from\ (firstCol+shift,\ firstCol+shift)\ to\ (lastCol+shift,\ lastCol+shift)\ [inclusive]}}
\DoxyCodeLine{01042\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{01043\ \textcolor{keywordtype}{void}\ BDCSVD<MatrixType>::deflation(Index\ firstCol,\ Index\ lastCol,\ Index\ k,\ Index\ firstRowW,\ Index\ firstColW,\ Index\ shift)}
\DoxyCodeLine{01044\ \{}
\DoxyCodeLine{01045\ \ \ \textcolor{keyword}{using\ }std::sqrt;}
\DoxyCodeLine{01046\ \ \ \textcolor{keyword}{using\ }std::abs;}
\DoxyCodeLine{01047\ \ \ \textcolor{keyword}{const}\ Index\ length\ =\ lastCol\ +\ 1\ -\/\ firstCol;}
\DoxyCodeLine{01048\ \ \ }
\DoxyCodeLine{01049\ \ \ Block<MatrixXr,Dynamic,1>\ col0(m\_computed,\ firstCol+shift,\ firstCol+shift,\ length,\ 1);}
\DoxyCodeLine{01050\ \ \ Diagonal<MatrixXr>\ fulldiag(m\_computed);}
\DoxyCodeLine{01051\ \ \ VectorBlock<Diagonal<MatrixXr>,Dynamic>\ diag(fulldiag,\ firstCol+shift,\ length);}
\DoxyCodeLine{01052\ \ \ }
\DoxyCodeLine{01053\ \ \ \textcolor{keyword}{const}\ RealScalar\ considerZero\ =\ (std::numeric\_limits<RealScalar>::min)();}
\DoxyCodeLine{01054\ \ \ RealScalar\ maxDiag\ =\ diag.tail((std::max)(Index(1),length-\/1)).cwiseAbs().maxCoeff();}
\DoxyCodeLine{01055\ \ \ RealScalar\ epsilon\_strict\ =\ numext::maxi<RealScalar>(considerZero,NumTraits<RealScalar>::epsilon()\ *\ maxDiag);}
\DoxyCodeLine{01056\ \ \ RealScalar\ epsilon\_coarse\ =\ 8\ *\ NumTraits<RealScalar>::epsilon()\ *\ numext::maxi<RealScalar>(col0.cwiseAbs().maxCoeff(),\ maxDiag);}
\DoxyCodeLine{01057\ \ \ }
\DoxyCodeLine{01058\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{01059\ \ \ assert(m\_naiveU.allFinite());}
\DoxyCodeLine{01060\ \ \ assert(m\_naiveV.allFinite());}
\DoxyCodeLine{01061\ \ \ assert(m\_computed.allFinite());}
\DoxyCodeLine{01062\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01063\ }
\DoxyCodeLine{01064\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE\ \ }}
\DoxyCodeLine{01065\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)ndeflate:"{}}\ <<\ diag.head(k+1).transpose()\ <<\ \textcolor{stringliteral}{"{}\ \ |\ \ "{}}\ <<\ diag.segment(k+1,length-\/k-\/1).transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01066\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01067\ \ \ }
\DoxyCodeLine{01068\ \ \ \textcolor{comment}{//condition\ 4.1}}
\DoxyCodeLine{01069\ \ \ \textcolor{keywordflow}{if}\ (diag(0)\ <\ epsilon\_coarse)}
\DoxyCodeLine{01070\ \ \ \{\ }
\DoxyCodeLine{01071\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01072\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}deflation\ 4.1,\ because\ "{}}\ <<\ diag(0)\ <<\ \textcolor{stringliteral}{"{}\ <\ "{}}\ <<\ epsilon\_coarse\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01073\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01074\ \ \ \ \ diag(0)\ =\ epsilon\_coarse;}
\DoxyCodeLine{01075\ \ \ \}}
\DoxyCodeLine{01076\ }
\DoxyCodeLine{01077\ \ \ \textcolor{comment}{//condition\ 4.2}}
\DoxyCodeLine{01078\ \ \ \textcolor{keywordflow}{for}\ (Index\ i=1;i<length;++i)}
\DoxyCodeLine{01079\ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(col0(i))\ <\ epsilon\_strict)}
\DoxyCodeLine{01080\ \ \ \ \ \{}
\DoxyCodeLine{01081\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01082\ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}deflation\ 4.2,\ set\ z("{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{})\ to\ zero\ because\ "{}}\ <<\ abs(col0(i))\ <<\ \textcolor{stringliteral}{"{}\ <\ "{}}\ <<\ epsilon\_strict\ <<\ \textcolor{stringliteral}{"{}\ \ (diag("{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{})="{}}\ <<\ diag(i)\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}};}
\DoxyCodeLine{01083\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01084\ \ \ \ \ \ \ col0(i)\ =\ 0;}
\DoxyCodeLine{01085\ \ \ \ \ \}}
\DoxyCodeLine{01086\ }
\DoxyCodeLine{01087\ \ \ \textcolor{comment}{//condition\ 4.3}}
\DoxyCodeLine{01088\ \ \ \textcolor{keywordflow}{for}\ (Index\ i=1;i<length;\ i++)}
\DoxyCodeLine{01089\ \ \ \ \ \textcolor{keywordflow}{if}\ (diag(i)\ <\ epsilon\_coarse)}
\DoxyCodeLine{01090\ \ \ \ \ \{}
\DoxyCodeLine{01091\ \textcolor{preprocessor}{\#ifdef\ \ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01092\ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}deflation\ 4.3,\ cancel\ z("{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{})="{}}\ <<\ col0(i)\ <<\ \textcolor{stringliteral}{"{}\ because\ diag("{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{})="{}}\ <<\ diag(i)\ <<\ \textcolor{stringliteral}{"{}\ <\ "{}}\ <<\ epsilon\_coarse\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01093\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01094\ \ \ \ \ \ \ deflation43(firstCol,\ shift,\ i,\ length);}
\DoxyCodeLine{01095\ \ \ \ \ \}}
\DoxyCodeLine{01096\ }
\DoxyCodeLine{01097\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{01098\ \ \ assert(m\_naiveU.allFinite());}
\DoxyCodeLine{01099\ \ \ assert(m\_naiveV.allFinite());}
\DoxyCodeLine{01100\ \ \ assert(m\_computed.allFinite());}
\DoxyCodeLine{01101\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01102\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01103\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}to\ be\ sorted:\ "{}}\ <<\ diag.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{01104\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01105\ \ \ \{}
\DoxyCodeLine{01106\ \ \ \ \ \textcolor{comment}{//\ Check\ for\ total\ deflation}}
\DoxyCodeLine{01107\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ a\ total\ deflation,\ then\ we\ have\ to\ consider\ col0(0)==diag(0)\ as\ a\ singular\ value\ during\ sorting}}
\DoxyCodeLine{01108\ \ \ \ \ \textcolor{keywordtype}{bool}\ total\_deflation\ =\ (col0.tail(length-\/1).array()<considerZero).all();}
\DoxyCodeLine{01109\ \ \ \ \ }
\DoxyCodeLine{01110\ \ \ \ \ \textcolor{comment}{//\ Sort\ the\ diagonal\ entries,\ since\ diag(1:k-\/1)\ and\ diag(k:length)\ are\ already\ sorted,\ let's\ do\ a\ sorted\ merge.}}
\DoxyCodeLine{01111\ \ \ \ \ \textcolor{comment}{//\ First,\ compute\ the\ respective\ permutation.}}
\DoxyCodeLine{01112\ \ \ \ \ Index\ *permutation\ =\ m\_workspaceI.data();}
\DoxyCodeLine{01113\ \ \ \ \ \{}
\DoxyCodeLine{01114\ \ \ \ \ \ \ permutation[0]\ =\ 0;}
\DoxyCodeLine{01115\ \ \ \ \ \ \ Index\ p\ =\ 1;}
\DoxyCodeLine{01116\ \ \ \ \ \ \ }
\DoxyCodeLine{01117\ \ \ \ \ \ \ \textcolor{comment}{//\ Move\ deflated\ diagonal\ entries\ at\ the\ end.}}
\DoxyCodeLine{01118\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(Index\ i=1;\ i<length;\ ++i)}
\DoxyCodeLine{01119\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(abs(diag(i))<considerZero)}
\DoxyCodeLine{01120\ \ \ \ \ \ \ \ \ \ \ permutation[p++]\ =\ i;}
\DoxyCodeLine{01121\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01122\ \ \ \ \ \ \ Index\ i=1,\ j=k+1;}
\DoxyCodeLine{01123\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ ;\ p\ <\ length;\ ++p)}
\DoxyCodeLine{01124\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ >\ k)\ \ \ \ \ \ \ \ \ \ \ \ \ permutation[p]\ =\ j++;}
\DoxyCodeLine{01126\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (j\ >=\ length)\ \ \ \ \ \ \ permutation[p]\ =\ i++;}
\DoxyCodeLine{01127\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (diag(i)\ <\ diag(j))\ permutation[p]\ =\ j++;}
\DoxyCodeLine{01128\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ permutation[p]\ =\ i++;}
\DoxyCodeLine{01129\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01130\ \ \ \ \ \}}
\DoxyCodeLine{01131\ \ \ \ \ }
\DoxyCodeLine{01132\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ a\ total\ deflation,\ then\ we\ have\ to\ insert\ diag(0)\ at\ the\ right\ place}}
\DoxyCodeLine{01133\ \ \ \ \ \textcolor{keywordflow}{if}(total\_deflation)}
\DoxyCodeLine{01134\ \ \ \ \ \{}
\DoxyCodeLine{01135\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(Index\ i=1;\ i<length;\ ++i)}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ Index\ pi\ =\ permutation[i];}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(abs(diag(pi))<considerZero\ ||\ diag(0)<diag(pi))}
\DoxyCodeLine{01139\ \ \ \ \ \ \ \ \ \ \ permutation[i-\/1]\ =\ permutation[i];}
\DoxyCodeLine{01140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01141\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01142\ \ \ \ \ \ \ \ \ \ \ permutation[i-\/1]\ =\ 0;}
\DoxyCodeLine{01143\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01144\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01145\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01146\ \ \ \ \ \}}
\DoxyCodeLine{01147\ \ \ \ \ }
\DoxyCodeLine{01148\ \ \ \ \ \textcolor{comment}{//\ Current\ index\ of\ each\ col,\ and\ current\ column\ of\ each\ index}}
\DoxyCodeLine{01149\ \ \ \ \ Index\ *realInd\ =\ m\_workspaceI.data()+length;}
\DoxyCodeLine{01150\ \ \ \ \ Index\ *realCol\ =\ m\_workspaceI.data()+2*length;}
\DoxyCodeLine{01151\ \ \ \ \ }
\DoxyCodeLine{01152\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ pos\ =\ 0;\ pos<\ length;\ pos++)}
\DoxyCodeLine{01153\ \ \ \ \ \{}
\DoxyCodeLine{01154\ \ \ \ \ \ \ realCol[pos]\ =\ pos;}
\DoxyCodeLine{01155\ \ \ \ \ \ \ realInd[pos]\ =\ pos;}
\DoxyCodeLine{01156\ \ \ \ \ \}}
\DoxyCodeLine{01157\ \ \ \ \ }
\DoxyCodeLine{01158\ \ \ \ \ \textcolor{keywordflow}{for}(Index\ i\ =\ total\_deflation?0:1;\ i\ <\ length;\ i++)}
\DoxyCodeLine{01159\ \ \ \ \ \{}
\DoxyCodeLine{01160\ \ \ \ \ \ \ \textcolor{keyword}{const}\ Index\ pi\ =\ permutation[length\ -\/\ (total\_deflation\ ?\ i+1\ :\ i)];}
\DoxyCodeLine{01161\ \ \ \ \ \ \ \textcolor{keyword}{const}\ Index\ J\ =\ realCol[pi];}
\DoxyCodeLine{01162\ \ \ \ \ \ \ }
\DoxyCodeLine{01163\ \ \ \ \ \ \ \textcolor{keyword}{using\ }std::swap;}
\DoxyCodeLine{01164\ \ \ \ \ \ \ \textcolor{comment}{//\ swap\ diagonal\ and\ first\ column\ entries:}}
\DoxyCodeLine{01165\ \ \ \ \ \ \ swap(diag(i),\ diag(J));}
\DoxyCodeLine{01166\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i!=0\ \&\&\ J!=0)\ swap(col0(i),\ col0(J));}
\DoxyCodeLine{01167\ }
\DoxyCodeLine{01168\ \ \ \ \ \ \ \textcolor{comment}{//\ change\ columns}}
\DoxyCodeLine{01169\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_compU)\ m\_naiveU.col(firstCol+i).segment(firstCol,\ length\ +\ 1).swap(m\_naiveU.col(firstCol+J).segment(firstCol,\ length\ +\ 1));}
\DoxyCodeLine{01170\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ m\_naiveU.col(firstCol+i).segment(0,\ 2)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .swap(m\_naiveU.col(firstCol+J).segment(0,\ 2));}
\DoxyCodeLine{01171\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_compV)\ m\_naiveV.col(firstColW\ +\ i).segment(firstRowW,\ length).swap(m\_naiveV.col(firstColW\ +\ J).segment(firstRowW,\ length));}
\DoxyCodeLine{01172\ }
\DoxyCodeLine{01173\ \ \ \ \ \ \ \textcolor{comment}{//update\ real\ pos}}
\DoxyCodeLine{01174\ \ \ \ \ \ \ \textcolor{keyword}{const}\ Index\ realI\ =\ realInd[i];}
\DoxyCodeLine{01175\ \ \ \ \ \ \ realCol[realI]\ =\ J;}
\DoxyCodeLine{01176\ \ \ \ \ \ \ realCol[pi]\ =\ i;}
\DoxyCodeLine{01177\ \ \ \ \ \ \ realInd[J]\ =\ realI;}
\DoxyCodeLine{01178\ \ \ \ \ \ \ realInd[i]\ =\ pi;}
\DoxyCodeLine{01179\ \ \ \ \ \}}
\DoxyCodeLine{01180\ \ \ \}}
\DoxyCodeLine{01181\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01182\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}sorted:\ "{}}\ <<\ diag.transpose().format(bdcsvdfmt)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01183\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ \ \ :\ "{}}\ <<\ col0.transpose()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{01184\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01185\ \ \ \ \ }
\DoxyCodeLine{01186\ \ \ \textcolor{comment}{//condition\ 4.4}}
\DoxyCodeLine{01187\ \ \ \{}
\DoxyCodeLine{01188\ \ \ \ \ Index\ i\ =\ length-\/1;}
\DoxyCodeLine{01189\ \ \ \ \ \textcolor{keywordflow}{while}(i>0\ \&\&\ (abs(diag(i))<considerZero\ ||\ abs(col0(i))<considerZero))\ -\/-\/i;}
\DoxyCodeLine{01190\ \ \ \ \ \textcolor{keywordflow}{for}(;\ i>1;-\/-\/i)}
\DoxyCodeLine{01191\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ (diag(i)\ -\/\ diag(i-\/1))\ <\ NumTraits<RealScalar>::epsilon()*maxDiag\ )}
\DoxyCodeLine{01192\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01193\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_DEBUG\_VERBOSE}}
\DoxyCodeLine{01194\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}deflation\ 4.4\ with\ i\ =\ "{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{}\ because\ "{}}\ <<\ (diag(i)\ -\/\ diag(i-\/1))\ <<\ \textcolor{stringliteral}{"{}\ <\ "{}}\ <<\ NumTraits<RealScalar>::epsilon()*diag(i)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01195\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01196\ \ \ \ \ \ \ \ \ eigen\_internal\_assert(abs(diag(i)\ -\/\ diag(i-\/1))<epsilon\_coarse\ \&\&\ \textcolor{stringliteral}{"{}\ diagonal\ entries\ are\ not\ properly\ sorted"{}});}
\DoxyCodeLine{01197\ \ \ \ \ \ \ \ \ deflation44(firstCol,\ firstCol\ +\ shift,\ firstRowW,\ firstColW,\ i-\/1,\ i,\ length);}
\DoxyCodeLine{01198\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01199\ \ \ \}}
\DoxyCodeLine{01200\ \ \ }
\DoxyCodeLine{01201\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{01202\ \ \ \textcolor{keywordflow}{for}(Index\ j=2;j<length;++j)}
\DoxyCodeLine{01203\ \ \ \ \ assert(diag(j-\/1)<=diag(j)\ ||\ abs(diag(j))<considerZero);}
\DoxyCodeLine{01204\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01205\ \ \ }
\DoxyCodeLine{01206\ \textcolor{preprocessor}{\#ifdef\ EIGEN\_BDCSVD\_SANITY\_CHECKS}}
\DoxyCodeLine{01207\ \ \ assert(m\_naiveU.allFinite());}
\DoxyCodeLine{01208\ \ \ assert(m\_naiveV.allFinite());}
\DoxyCodeLine{01209\ \ \ assert(m\_computed.allFinite());}
\DoxyCodeLine{01210\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01211\ \}\textcolor{comment}{//end\ deflation}}
\DoxyCodeLine{01212\ }
\DoxyCodeLine{01213\ \textcolor{preprocessor}{\#ifndef\ \_\_CUDACC\_\_}}
\DoxyCodeLine{01220\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Derived>}
\DoxyCodeLine{01221\ BDCSVD<typename\ MatrixBase<Derived>::PlainObject>}
\DoxyCodeLine{01222\ \mbox{\hyperlink{class_eigen_1_1_matrix_base_ae171b74b5d530846ee0836135ffcf837}{MatrixBase<Derived>::bdcSvd}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ computationOptions)\textcolor{keyword}{\ const}}
\DoxyCodeLine{01223\ \textcolor{keyword}{}\{}
\DoxyCodeLine{01224\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_eigen_1_1_b_d_c_s_v_d}{BDCSVD<PlainObject>}}(*\textcolor{keyword}{this},\ computationOptions);}
\DoxyCodeLine{01225\ \}}
\DoxyCodeLine{01226\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01227\ }
\DoxyCodeLine{01228\ \}\ \textcolor{comment}{//\ end\ namespace\ Eigen}}
\DoxyCodeLine{01229\ }
\DoxyCodeLine{01230\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
