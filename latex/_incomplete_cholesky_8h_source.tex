\doxysection{Incomplete\+Cholesky.\+h}
\hypertarget{_incomplete_cholesky_8h_source}{}\label{_incomplete_cholesky_8h_source}\index{packages/Eigen.3.3.3/build/native/include/Eigen/src/IterativeLinearSolvers/IncompleteCholesky.h@{packages/Eigen.3.3.3/build/native/include/Eigen/src/IterativeLinearSolvers/IncompleteCholesky.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ This\ file\ is\ part\ of\ Eigen,\ a\ lightweight\ C++\ template\ library}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ for\ linear\ algebra.}}
\DoxyCodeLine{00003\ \textcolor{comment}{//}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ Copyright\ (C)\ 2012\ Désiré\ Nuentsa-\/Wakam\ <desire.nuentsa\_wakam@inria.fr>}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ Copyright\ (C)\ 2015\ Gael\ Guennebaud\ <gael.guennebaud@inria.fr>}}
\DoxyCodeLine{00006\ \textcolor{comment}{//}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ This\ Source\ Code\ Form\ is\ subject\ to\ the\ terms\ of\ the\ Mozilla}}
\DoxyCodeLine{00008\ \textcolor{comment}{//\ Public\ License\ v.\ 2.0.\ If\ a\ copy\ of\ the\ MPL\ was\ not\ distributed}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ with\ this\ file,\ You\ can\ obtain\ one\ at\ http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#ifndef\ EIGEN\_INCOMPLETE\_CHOlESKY\_H}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#define\ EIGEN\_INCOMPLETE\_CHOlESKY\_H}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <list>}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{namespace\ }Eigen\ \{\ \ }
\DoxyCodeLine{00044\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Scalar,\ \textcolor{keywordtype}{int}\ \_UpLo\ =\ \mbox{\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaf581029282d421eee5aae14238c6f749}{Lower}},\ \textcolor{keyword}{typename}\ \_OrderingType\ =}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#ifndef\ EIGEN\_MPL2\_ONLY}}
\DoxyCodeLine{00046\ AMDOrdering<int>}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00048\ NaturalOrdering<int>}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00050\ >}
\DoxyCodeLine{00051\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky}{IncompleteCholesky}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_eigen_1_1_sparse_solver_base}{SparseSolverBase}}<IncompleteCholesky<Scalar,\_UpLo,\_OrderingType>\ >}
\DoxyCodeLine{00052\ \{}
\DoxyCodeLine{00053\ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_eigen_1_1_sparse_solver_base}{SparseSolverBase<IncompleteCholesky<Scalar,\_UpLo,\_OrderingType>}}\ >\ \mbox{\hyperlink{class_eigen_1_1_sparse_solver_base}{Base}};}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keyword}{using\ }Base::m\_isInitialized;}
\DoxyCodeLine{00056\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ NumTraits<Scalar>::Real\ RealScalar;\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{typedef}\ \_OrderingType\ OrderingType;}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ OrderingType::PermutationType\ PermutationType;}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ PermutationType::StorageIndex\ StorageIndex;\ }
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_eigen_1_1_sparse_matrix}{SparseMatrix<Scalar,ColMajor,StorageIndex>}}\ \mbox{\hyperlink{class_eigen_1_1_sparse_matrix}{FactorType}};}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{Matrix<Scalar,Dynamic,1>}}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{VectorSx}};}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{Matrix<RealScalar,Dynamic,1>}}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{VectorRx}};}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{Matrix<StorageIndex,Dynamic,\ 1>}}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{VectorIx}};}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keyword}{typedef}\ std::vector<std::list<StorageIndex>\ >\ VectorList;\ }
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{enum}\ \{\ UpLo\ =\ \_UpLo\ \};}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ ColsAtCompileTime\ =\ Dynamic,}
\DoxyCodeLine{00069\ \ \ \ \ \ \ MaxColsAtCompileTime\ =\ Dynamic}
\DoxyCodeLine{00070\ \ \ \ \ \};}
\DoxyCodeLine{00071\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00079\ \ \ \ \ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_adaaa3975b8cf53f910d6a3344af92379}{IncompleteCholesky}}()\ :\ m\_initialShift(1e-\/3),m\_factorizationIsOk(false)\ \{\}}
\DoxyCodeLine{00080\ \ \ \ \ }
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00084\ \ \ \ \ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_a757499fc814988a5b112b1f34d0295e1}{IncompleteCholesky}}(\textcolor{keyword}{const}\ MatrixType\&\ matrix)\ :\ m\_initialShift(1e-\/3),m\_factorizationIsOk(false)}
\DoxyCodeLine{00085\ \ \ \ \ \{}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_a7966bedeebbeaa7a8fe4dd1da3797a0b}{compute}}(matrix);}
\DoxyCodeLine{00087\ \ \ \ \ \}}
\DoxyCodeLine{00088\ \ \ \ \ }
\DoxyCodeLine{00090\ \ \ \ \ Index\ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_a4780a83266c871782595081021268b5a}{rows}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ m\_L.\mbox{\hyperlink{class_eigen_1_1_sparse_matrix_a0796a8adefc3c976877bd32621587424}{rows}}();\ \}}
\DoxyCodeLine{00091\ \ \ \ \ }
\DoxyCodeLine{00093\ \ \ \ \ Index\ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_a0d66a1c8e340617e7ff404e63186fedb}{cols}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ m\_L.\mbox{\hyperlink{class_eigen_1_1_sparse_matrix_a02f9cfa31e16953a24968698b216c604}{cols}}();\ \}}
\DoxyCodeLine{00094\ \ \ \ \ }
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00104\ \ \ \ \ \mbox{\hyperlink{group__enums_ga85fad7b87587764e5cf6b513a9e0ee5e}{ComputationInfo}}\ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_ada0e68cb22601849464506f5986a88c1}{info}}()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00105\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ eigen\_assert(m\_isInitialized\ \&\&\ \textcolor{stringliteral}{"{}IncompleteCholesky\ is\ not\ initialized."{}});}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ m\_info;}
\DoxyCodeLine{00108\ \ \ \ \ \}}
\DoxyCodeLine{00109\ \ \ \ \ }
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_a409c9586e7d29566dda2c8f5e38a1228}{setInitialShift}}(RealScalar\ shift)\ \{\ m\_initialShift\ =\ shift;\ \}}
\DoxyCodeLine{00113\ \ \ \ \ }
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_a702560ecdddef77dc51d20ab22bd974e}{analyzePattern}}(\textcolor{keyword}{const}\ MatrixType\&\ mat)}
\DoxyCodeLine{00118\ \ \ \ \ \{}
\DoxyCodeLine{00119\ \ \ \ \ \ \ OrderingType\ ord;\ }
\DoxyCodeLine{00120\ \ \ \ \ \ \ PermutationType\ pinv;}
\DoxyCodeLine{00121\ \ \ \ \ \ \ ord(mat.template\ selfadjointView<UpLo>(),\ pinv);\ }
\DoxyCodeLine{00122\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(pinv.size()>0)\ m\_perm\ =\ pinv.inverse();}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_perm.resize(0);}
\DoxyCodeLine{00124\ \ \ \ \ \ \ m\_L.\mbox{\hyperlink{class_eigen_1_1_sparse_matrix_a15dcd27320636526be90d60b1912e895}{resize}}(mat.rows(),\ mat.cols());}
\DoxyCodeLine{00125\ \ \ \ \ \ \ m\_analysisIsOk\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00126\ \ \ \ \ \ \ m\_isInitialized\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00127\ \ \ \ \ \ \ m\_info\ =\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea671a2aeb0f527802806a441d58a80fcf}{Success}};}
\DoxyCodeLine{00128\ \ \ \ \ \}}
\DoxyCodeLine{00129\ \ \ \ \ }
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_ac39c75ff7ca5d2db9a9f03b937e12601}{factorize}}(\textcolor{keyword}{const}\ MatrixType\&\ mat);}
\DoxyCodeLine{00139\ \ \ \ \ }
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ MatrixType>}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_a7966bedeebbeaa7a8fe4dd1da3797a0b}{compute}}(\textcolor{keyword}{const}\ MatrixType\&\ mat)}
\DoxyCodeLine{00148\ \ \ \ \ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_a702560ecdddef77dc51d20ab22bd974e}{analyzePattern}}(mat);}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_ac39c75ff7ca5d2db9a9f03b937e12601}{factorize}}(mat);}
\DoxyCodeLine{00151\ \ \ \ \ \}}
\DoxyCodeLine{00152\ \ \ \ \ }
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{comment}{//\ internal}}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Rhs,\ \textcolor{keyword}{typename}\ Dest>}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordtype}{void}\ \_solve\_impl(\textcolor{keyword}{const}\ Rhs\&\ b,\ Dest\&\ x)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00156\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ eigen\_assert(m\_factorizationIsOk\ \&\&\ \textcolor{stringliteral}{"{}factorize()\ should\ be\ called\ first"{}});}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_perm.rows()\ ==\ b.rows())\ \ x\ =\ m\_perm\ *\ b;}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x\ =\ b;}
\DoxyCodeLine{00160\ \ \ \ \ \ \ x\ =\ m\_scale.asDiagonal()\ *\ x;}
\DoxyCodeLine{00161\ \ \ \ \ \ \ x\ =\ m\_L.template\ triangularView<Lower>().solve(x);}
\DoxyCodeLine{00162\ \ \ \ \ \ \ x\ =\ m\_L.adjoint().template\ triangularView<Upper>().solve(x);}
\DoxyCodeLine{00163\ \ \ \ \ \ \ x\ =\ m\_scale.asDiagonal()\ *\ x;}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_perm.rows()\ ==\ b.rows())}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ x\ =\ m\_perm.inverse()\ *\ x;}
\DoxyCodeLine{00166\ \ \ \ \ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_eigen_1_1_sparse_matrix}{FactorType}}\&\ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_ae731a1e5b3e8d86b4eb87fd07a4e3532}{matrixL}}()\textcolor{keyword}{\ const\ }\{\ eigen\_assert(\textcolor{stringliteral}{"{}m\_factorizationIsOk"{}});\ \textcolor{keywordflow}{return}\ m\_L;\ \}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_eigen_1_1_matrix}{VectorRx}}\&\ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_a781d291f3dc3cb5fd339ab99a18cddd0}{scalingS}}()\textcolor{keyword}{\ const\ }\{\ eigen\_assert(\textcolor{stringliteral}{"{}m\_factorizationIsOk"{}});\ \textcolor{keywordflow}{return}\ m\_scale;\ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keyword}{const}\ PermutationType\&\ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_abd97f2b0c2463f009edbe8f9f7e6599a}{permutationP}}()\textcolor{keyword}{\ const\ }\{\ eigen\_assert(\textcolor{stringliteral}{"{}m\_analysisIsOk"{}});\ \textcolor{keywordflow}{return}\ m\_perm;\ \}}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00178\ \ \ \ \ FactorType\ m\_L;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ lower\ part\ stored\ in\ CSC}}
\DoxyCodeLine{00179\ \ \ \ \ VectorRx\ m\_scale;\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ vector\ for\ scaling\ the\ matrix\ }}
\DoxyCodeLine{00180\ \ \ \ \ RealScalar\ m\_initialShift;\ \ \ \textcolor{comment}{//\ The\ initial\ shift\ parameter}}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_analysisIsOk;\ }
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_factorizationIsOk;\ }
\DoxyCodeLine{00183\ \ \ \ \ \mbox{\hyperlink{group__enums_ga85fad7b87587764e5cf6b513a9e0ee5e}{ComputationInfo}}\ m\_info;}
\DoxyCodeLine{00184\ \ \ \ \ PermutationType\ m\_perm;\ }
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ updateList(\mbox{\hyperlink{class_eigen_1_1_ref}{Ref<const\ VectorIx>}}\ colPtr,\ \mbox{\hyperlink{class_eigen_1_1_ref}{Ref<VectorIx>}}\ rowIdx,\ \mbox{\hyperlink{class_eigen_1_1_ref}{Ref<VectorSx>}}\ vals,\ \textcolor{keyword}{const}\ Index\&\ col,\ \textcolor{keyword}{const}\ Index\&\ jk,\ VectorIx\&\ firstElt,\ VectorList\&\ listCol);\ }
\DoxyCodeLine{00188\ \};\ }
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \textcolor{comment}{//\ Based\ on\ the\ following\ paper:}}
\DoxyCodeLine{00191\ \textcolor{comment}{//\ \ \ C-\/J.\ Lin\ and\ J.\ J.\ Moré,\ Incomplete\ Cholesky\ Factorizations\ with}}
\DoxyCodeLine{00192\ \textcolor{comment}{//\ \ \ Limited\ memory,\ SIAM\ J.\ Sci.\ Comput.\ \ 21(1),\ pp.\ 24-\/45,\ 1999}}
\DoxyCodeLine{00193\ \textcolor{comment}{//\ \ \ http://ftp.mcs.anl.gov/pub/tech\_reports/reports/P682.pdf}}
\DoxyCodeLine{00194\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Scalar,\ \textcolor{keywordtype}{int}\ \_UpLo,\ \textcolor{keyword}{typename}\ OrderingType>}
\DoxyCodeLine{00195\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ \_MatrixType>}
\DoxyCodeLine{00196\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_eigen_1_1_incomplete_cholesky_ac39c75ff7ca5d2db9a9f03b937e12601}{IncompleteCholesky<Scalar,\_UpLo,\ OrderingType>::factorize}}(\textcolor{keyword}{const}\ \_MatrixType\&\ mat)}
\DoxyCodeLine{00197\ \{}
\DoxyCodeLine{00198\ \ \ \textcolor{keyword}{using\ }std::sqrt;}
\DoxyCodeLine{00199\ \ \ eigen\_assert(m\_analysisIsOk\ \&\&\ \textcolor{stringliteral}{"{}analyzePattern()\ should\ be\ called\ first"{}});\ }
\DoxyCodeLine{00200\ \ \ \ \ }
\DoxyCodeLine{00201\ \ \ \textcolor{comment}{//\ Dropping\ strategy\ :\ Keep\ only\ the\ p\ largest\ elements\ per\ column,\ where\ p\ is\ the\ number\ of\ elements\ in\ the\ column\ of\ the\ original\ matrix.\ Other\ strategies\ will\ be\ added}}
\DoxyCodeLine{00202\ \ \ }
\DoxyCodeLine{00203\ \ \ \textcolor{comment}{//\ Apply\ the\ fill-\/reducing\ permutation\ computed\ in\ analyzePattern()}}
\DoxyCodeLine{00204\ \ \ \textcolor{keywordflow}{if}\ (m\_perm.rows()\ ==\ mat.rows()\ )\ \textcolor{comment}{//\ To\ detect\ the\ null\ permutation}}
\DoxyCodeLine{00205\ \ \ \{}
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{comment}{//\ The\ temporary\ is\ needed\ to\ make\ sure\ that\ the\ diagonal\ entry\ is\ properly\ sorted}}
\DoxyCodeLine{00207\ \ \ \ \ FactorType\ tmp(mat.rows(),\ mat.cols());}
\DoxyCodeLine{00208\ \ \ \ \ tmp\ =\ mat.template\ selfadjointView<\_UpLo>().twistedBy(m\_perm);}
\DoxyCodeLine{00209\ \ \ \ \ m\_L.template\ selfadjointView<Lower>()\ =\ tmp.template\ selfadjointView<Lower>();}
\DoxyCodeLine{00210\ \ \ \}}
\DoxyCodeLine{00211\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00212\ \ \ \{}
\DoxyCodeLine{00213\ \ \ \ \ m\_L.template\ selfadjointView<Lower>()\ =\ mat.template\ selfadjointView<\_UpLo>();}
\DoxyCodeLine{00214\ \ \ \}}
\DoxyCodeLine{00215\ \ \ }
\DoxyCodeLine{00216\ \ \ Index\ n\ =\ m\_L.cols();\ }
\DoxyCodeLine{00217\ \ \ Index\ nnz\ =\ m\_L.nonZeros();}
\DoxyCodeLine{00218\ \ \ Map<VectorSx>\ vals(m\_L.valuePtr(),\ nnz);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//values}}
\DoxyCodeLine{00219\ \ \ Map<VectorIx>\ rowIdx(m\_L.innerIndexPtr(),\ nnz);\ \ \textcolor{comment}{//Row\ indices}}
\DoxyCodeLine{00220\ \ \ Map<VectorIx>\ colPtr(\ m\_L.outerIndexPtr(),\ n+1);\ \textcolor{comment}{//\ Pointer\ to\ the\ beginning\ of\ each\ row}}
\DoxyCodeLine{00221\ \ \ VectorIx\ firstElt(n-\/1);\ \textcolor{comment}{//\ for\ each\ j,\ points\ to\ the\ next\ entry\ in\ vals\ that\ will\ be\ used\ in\ the\ factorization}}
\DoxyCodeLine{00222\ \ \ VectorList\ listCol(n);\ \ \textcolor{comment}{//\ listCol(j)\ is\ a\ linked\ list\ of\ columns\ to\ update\ column\ j}}
\DoxyCodeLine{00223\ \ \ VectorSx\ col\_vals(n);\ \ \ \textcolor{comment}{//\ Store\ a\ \ nonzero\ values\ in\ each\ column}}
\DoxyCodeLine{00224\ \ \ VectorIx\ col\_irow(n);\ \ \ \textcolor{comment}{//\ Row\ indices\ of\ nonzero\ elements\ in\ each\ column}}
\DoxyCodeLine{00225\ \ \ VectorIx\ col\_pattern(n);}
\DoxyCodeLine{00226\ \ \ col\_pattern.fill(-\/1);}
\DoxyCodeLine{00227\ \ \ StorageIndex\ col\_nnz;}
\DoxyCodeLine{00228\ \ \ }
\DoxyCodeLine{00229\ \ \ }
\DoxyCodeLine{00230\ \ \ \textcolor{comment}{//\ Computes\ the\ scaling\ factors\ }}
\DoxyCodeLine{00231\ \ \ m\_scale.resize(n);}
\DoxyCodeLine{00232\ \ \ m\_scale.setZero();}
\DoxyCodeLine{00233\ \ \ \textcolor{keywordflow}{for}\ (Index\ j\ =\ 0;\ j\ <\ n;\ j++)}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keywordflow}{for}\ (Index\ k\ =\ colPtr[j];\ k\ <\ colPtr[j+1];\ k++)}
\DoxyCodeLine{00235\ \ \ \ \ \{}
\DoxyCodeLine{00236\ \ \ \ \ \ \ m\_scale(j)\ +=\ numext::abs2(vals(k));}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(rowIdx[k]!=j)}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ m\_scale(rowIdx[k])\ +=\ numext::abs2(vals(k));}
\DoxyCodeLine{00239\ \ \ \ \ \}}
\DoxyCodeLine{00240\ \ \ }
\DoxyCodeLine{00241\ \ \ m\_scale\ =\ m\_scale.cwiseSqrt().cwiseSqrt();}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \textcolor{keywordflow}{for}\ (Index\ j\ =\ 0;\ j\ <\ n;\ ++j)}
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{keywordflow}{if}(m\_scale(j)>(std::numeric\_limits<RealScalar>::min)())}
\DoxyCodeLine{00245\ \ \ \ \ \ \ m\_scale(j)\ =\ RealScalar(1)/m\_scale(j);}
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00247\ \ \ \ \ \ \ m\_scale(j)\ =\ 1;}
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \ \ \textcolor{comment}{//\ TODO\ disable\ scaling\ if\ not\ needed,\ i.e.,\ if\ it\ is\ roughly\ uniform?\ (this\ will\ make\ solve()\ faster)}}
\DoxyCodeLine{00250\ \ \ }
\DoxyCodeLine{00251\ \ \ \textcolor{comment}{//\ Scale\ and\ compute\ the\ shift\ for\ the\ matrix\ }}
\DoxyCodeLine{00252\ \ \ RealScalar\ mindiag\ =\ NumTraits<RealScalar>::highest();}
\DoxyCodeLine{00253\ \ \ \textcolor{keywordflow}{for}\ (Index\ j\ =\ 0;\ j\ <\ n;\ j++)}
\DoxyCodeLine{00254\ \ \ \{}
\DoxyCodeLine{00255\ \ \ \ \ \textcolor{keywordflow}{for}\ (Index\ k\ =\ colPtr[j];\ k\ <\ colPtr[j+1];\ k++)}
\DoxyCodeLine{00256\ \ \ \ \ \ \ vals[k]\ *=\ (m\_scale(j)*m\_scale(rowIdx[k]));}
\DoxyCodeLine{00257\ \ \ \ \ eigen\_internal\_assert(rowIdx[colPtr[j]]==j\ \&\&\ \textcolor{stringliteral}{"{}IncompleteCholesky:\ only\ the\ lower\ triangular\ part\ must\ be\ stored"{}});}
\DoxyCodeLine{00258\ \ \ \ \ mindiag\ =\ numext::mini(numext::real(vals[colPtr[j]]),\ mindiag);}
\DoxyCodeLine{00259\ \ \ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ FactorType\ L\_save\ =\ m\_L;}
\DoxyCodeLine{00262\ \ \ }
\DoxyCodeLine{00263\ \ \ RealScalar\ shift\ =\ 0;}
\DoxyCodeLine{00264\ \ \ \textcolor{keywordflow}{if}(mindiag\ <=\ RealScalar(0.))}
\DoxyCodeLine{00265\ \ \ \ \ shift\ =\ m\_initialShift\ -\/\ mindiag;}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ m\_info\ =\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea1c6e20706575a629b27a105f07f1883b}{NumericalIssue}};}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \textcolor{comment}{//\ Try\ to\ perform\ the\ incomplete\ factorization\ using\ the\ current\ shift}}
\DoxyCodeLine{00270\ \ \ \textcolor{keywordtype}{int}\ iter\ =\ 0;}
\DoxyCodeLine{00271\ \ \ \textcolor{keywordflow}{do}}
\DoxyCodeLine{00272\ \ \ \{}
\DoxyCodeLine{00273\ \ \ \ \ \textcolor{comment}{//\ Apply\ the\ shift\ to\ the\ diagonal\ elements\ of\ the\ matrix}}
\DoxyCodeLine{00274\ \ \ \ \ \textcolor{keywordflow}{for}\ (Index\ j\ =\ 0;\ j\ <\ n;\ j++)}
\DoxyCodeLine{00275\ \ \ \ \ \ \ vals[colPtr[j]]\ +=\ shift;}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{comment}{//\ jki\ version\ of\ the\ Cholesky\ factorization}}
\DoxyCodeLine{00278\ \ \ \ \ Index\ j=0;}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{keywordflow}{for}\ (;\ j\ <\ n;\ ++j)}
\DoxyCodeLine{00280\ \ \ \ \ \{}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \textcolor{comment}{//\ Left-\/looking\ factorization\ of\ the\ j-\/th\ column}}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \textcolor{comment}{//\ First,\ load\ the\ j-\/th\ column\ into\ col\_vals}}
\DoxyCodeLine{00283\ \ \ \ \ \ \ Scalar\ diag\ =\ vals[colPtr[j]];\ \ \textcolor{comment}{//\ It\ is\ assumed\ that\ only\ the\ lower\ part\ is\ stored}}
\DoxyCodeLine{00284\ \ \ \ \ \ \ col\_nnz\ =\ 0;}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (Index\ i\ =\ colPtr[j]\ +\ 1;\ i\ <\ colPtr[j+1];\ i++)}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ StorageIndex\ l\ =\ rowIdx[i];}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ col\_vals(col\_nnz)\ =\ vals[i];}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ col\_irow(col\_nnz)\ =\ l;}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ col\_pattern(l)\ =\ col\_nnz;}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ col\_nnz++;}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ std::list<StorageIndex>::iterator\ k;}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Browse\ all\ previous\ columns\ that\ will\ update\ column\ j}}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(k\ =\ listCol[j].begin();\ k\ !=\ listCol[j].end();\ k++)}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ Index\ jk\ =\ firstElt(*k);\ \textcolor{comment}{//\ First\ element\ to\ use\ in\ the\ column}}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ eigen\_internal\_assert(rowIdx[jk]==j);}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ Scalar\ v\_j\_jk\ =\ numext::conj(vals[jk]);}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ jk\ +=\ 1;}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (Index\ i\ =\ jk;\ i\ <\ colPtr[*k+1];\ i++)}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ StorageIndex\ l\ =\ rowIdx[i];}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(col\_pattern[l]<0)}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ col\_vals(col\_nnz)\ =\ vals[i]\ *\ v\_j\_jk;}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ col\_irow[col\_nnz]\ =\ l;}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ col\_pattern(l)\ =\ col\_nnz;}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ col\_nnz++;}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ col\_vals(col\_pattern[l])\ -\/=\ vals[i]\ *\ v\_j\_jk;}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ updateList(colPtr,rowIdx,vals,\ *k,\ jk,\ firstElt,\ listCol);}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \ \ \ \ \textcolor{comment}{//\ Scale\ the\ current\ column}}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(numext::real(diag)\ <=\ 0)}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(++iter>=10)}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ increase\ shift}}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ shift\ =\ numext::maxi(m\_initialShift,RealScalar(2)*shift);}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ restore\ m\_L,\ col\_pattern,\ and\ listCol}}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ vals\ =\ Map<const\ VectorSx>(L\_save.valuePtr(),\ nnz);}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ rowIdx\ =\ Map<const\ VectorIx>(L\_save.innerIndexPtr(),\ nnz);}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ colPtr\ =\ Map<const\ VectorIx>(L\_save.outerIndexPtr(),\ n+1);}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ col\_pattern.fill(-\/1);}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(Index\ i=0;\ i<n;\ ++i)}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \ \ listCol[i].clear();}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \ \ \ \ RealScalar\ rdiag\ =\ sqrt(numext::real(diag));}
\DoxyCodeLine{00340\ \ \ \ \ \ \ vals[colPtr[j]]\ =\ rdiag;}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (Index\ k\ =\ 0;\ k<col\_nnz;\ ++k)}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ Index\ i\ =\ col\_irow[k];}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \textcolor{comment}{//Scale}}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ col\_vals(k)\ /=\ rdiag;}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \textcolor{comment}{//Update\ the\ remaining\ diagonals\ with\ col\_vals}}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ vals[colPtr[i]]\ -\/=\ numext::abs2(col\_vals(k));}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \textcolor{comment}{//\ Select\ the\ largest\ p\ elements}}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \textcolor{comment}{//\ p\ is\ the\ original\ number\ of\ elements\ in\ the\ column\ (without\ the\ diagonal)}}
\DoxyCodeLine{00351\ \ \ \ \ \ \ Index\ p\ =\ colPtr[j+1]\ -\/\ colPtr[j]\ -\/\ 1\ ;}
\DoxyCodeLine{00352\ \ \ \ \ \ \ Ref<VectorSx>\ cvals\ =\ col\_vals.head(col\_nnz);}
\DoxyCodeLine{00353\ \ \ \ \ \ \ Ref<VectorIx>\ cirow\ =\ col\_irow.head(col\_nnz);}
\DoxyCodeLine{00354\ \ \ \ \ \ \ internal::QuickSplit(cvals,cirow,\ p);}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \textcolor{comment}{//\ Insert\ the\ largest\ p\ elements\ in\ the\ matrix}}
\DoxyCodeLine{00356\ \ \ \ \ \ \ Index\ cpt\ =\ 0;}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (Index\ i\ =\ colPtr[j]+1;\ i\ <\ colPtr[j+1];\ i++)}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ vals[i]\ =\ col\_vals(cpt);}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ rowIdx[i]\ =\ col\_irow(cpt);}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ restore\ col\_pattern:}}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ col\_pattern(col\_irow(cpt))\ =\ -\/1;}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ cpt++;}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ first\ smallest\ row\ index\ and\ put\ it\ after\ the\ diagonal\ element}}
\DoxyCodeLine{00366\ \ \ \ \ \ \ Index\ jk\ =\ colPtr(j)+1;}
\DoxyCodeLine{00367\ \ \ \ \ \ \ updateList(colPtr,rowIdx,vals,j,jk,firstElt,listCol);}
\DoxyCodeLine{00368\ \ \ \ \ \}}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{keywordflow}{if}(j==n)}
\DoxyCodeLine{00371\ \ \ \ \ \{}
\DoxyCodeLine{00372\ \ \ \ \ \ \ m\_factorizationIsOk\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00373\ \ \ \ \ \ \ m\_info\ =\ \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea671a2aeb0f527802806a441d58a80fcf}{Success}};}
\DoxyCodeLine{00374\ \ \ \ \ \}}
\DoxyCodeLine{00375\ \ \ \}\ \textcolor{keywordflow}{while}(m\_info!=\mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea671a2aeb0f527802806a441d58a80fcf}{Success}});}
\DoxyCodeLine{00376\ \}}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Scalar,\ \textcolor{keywordtype}{int}\ \_UpLo,\ \textcolor{keyword}{typename}\ OrderingType>}
\DoxyCodeLine{00379\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ IncompleteCholesky<Scalar,\_UpLo,\ OrderingType>::updateList(Ref<const\ VectorIx>\ colPtr,\ Ref<VectorIx>\ rowIdx,\ Ref<VectorSx>\ vals,\ \textcolor{keyword}{const}\ Index\&\ col,\ \textcolor{keyword}{const}\ Index\&\ jk,\ VectorIx\&\ firstElt,\ VectorList\&\ listCol)}
\DoxyCodeLine{00380\ \{}
\DoxyCodeLine{00381\ \ \ \textcolor{keywordflow}{if}\ (jk\ <\ colPtr(col+1)\ )}
\DoxyCodeLine{00382\ \ \ \{}
\DoxyCodeLine{00383\ \ \ \ \ Index\ p\ =\ colPtr(col+1)\ -\/\ jk;}
\DoxyCodeLine{00384\ \ \ \ \ Index\ minpos;\ }
\DoxyCodeLine{00385\ \ \ \ \ rowIdx.segment(jk,p).minCoeff(\&minpos);}
\DoxyCodeLine{00386\ \ \ \ \ minpos\ +=\ jk;}
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{keywordflow}{if}\ (rowIdx(minpos)\ !=\ rowIdx(jk))}
\DoxyCodeLine{00388\ \ \ \ \ \{}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \textcolor{comment}{//Swap}}
\DoxyCodeLine{00390\ \ \ \ \ \ \ std::swap(rowIdx(jk),rowIdx(minpos));}
\DoxyCodeLine{00391\ \ \ \ \ \ \ std::swap(vals(jk),vals(minpos));}
\DoxyCodeLine{00392\ \ \ \ \ \}}
\DoxyCodeLine{00393\ \ \ \ \ firstElt(col)\ =\ internal::convert\_index<StorageIndex,Index>(jk);}
\DoxyCodeLine{00394\ \ \ \ \ listCol[rowIdx(jk)].push\_back(internal::convert\_index<StorageIndex,Index>(col));}
\DoxyCodeLine{00395\ \ \ \}}
\DoxyCodeLine{00396\ \}}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ \}\ \textcolor{comment}{//\ end\ namespace\ Eigen\ }}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
